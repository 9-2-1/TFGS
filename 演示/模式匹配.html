<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<input style="width:100%;font-size:20px;" type="text" id="inn" />
<textarea style="width:100%;height:90%;font-size:20px;" type="text" id="out"></textarea>
<script>
	var inn = document.getElementById("inn");
	var out = document.getElementById("out");
	inn.addEventListener('keydown',function(event){
		setTimeout(function(){
			try{
				out.style.color = "black";
				out.value = match(inn.value);
			}catch(e){
				out.style.color = "red";
				out.value = e.message;
			}
		},0);
	});
	out.addEventListener('focus',function(event){
		out.blur();
	});
	var pattern = ["下一个背景","将.特效增加.","将.特效设定为.","清除图形特效","背景.","停止所有声音","将.音效增加.","将.音效设为.","清除音效","将音量增加.","将音量设为.%","当flag被点击","当按下.键","当.>.","等待.秒","重复执行.次.*","重复执行.*","如果.那么.","如果.那么.否则.","等待.","重复执行直到..*","询问.并等待","回答","按下.键?","按下鼠标?","鼠标的x坐标","鼠标的y坐标","响度","计时器","计时器归零","当前时间的.","2000年至今的天数","用户名",".+.",".-.",".*.","./.","在.和.之间取随机数",".>.",".<.",".=.",".与.",".或.",".不成立","连接.和.",".的第.个字符",".的字符数",".包含.?",".除以.的余数","四舍五入.","..","移动.步","右转.度","左转.度","移到 x:.y:.","在.秒内滑行到 x:.y:.","面向.方向","将x坐标增加.","将x坐标设为.","将y坐标增加.","将y坐标设为.","碰到边缘就反弹","将旋转方式设为.","x 坐标","y 坐标","方向","说..秒","说.","思考..秒","思考.","下一个造型","将大小增加.","将大小设为.","显示","隐藏","移到最.","..层","造型.","大小","音量","当角色被点击","当作为克隆体启动时","删除此克隆体","碰到颜色.?","颜色.碰到.?","将拖动模式设为.","击打..拍","休止.拍","演奏音符..拍","将乐器设为.","将演奏速度设定为.","将演奏速度增加.","演奏速度","全部擦除","图章","落笔","抬笔","将笔的颜色设为.","将笔的.增加.","将笔的.设为.","将笔的粗细增加.","将笔的粗细设为.","当视频运动 >.","相对于.的视频.",".摄像头","将视频透明度设为.","朗读.","使用.嗓音","将朗读语言设置为.","将.译为.","访客语言","移到.","在.秒内滑行到.","面向.","换成.造型","换成.背景","播放声音.等待播完","播放声音.","当背景换成.","当接收到.","广播.","广播.并等待","停止.","克隆.","碰到.?","到.的距离",".的.","1","将.设为.","将.增加.","显示变量.","隐藏变量.","2","将.加入.","删除.的第.项","删除.的全部项目","在.的第.项前插入.","将.的第.项替换为.",".的第.项",".中第一个.的编号",".的项目数",".包含.?","显示列表.","隐藏列表.","当按下.键","当依次按下.键时"];

	function match(text){
		var tree = [];
		var fillings = [];
		var diffCache;
		var resultIn;
		var results;
		var errorLevel = text.length * 0.5;
		do {
			errorLevel += 1;
			diffCache = {};
			resultIn = {};
			results = [];
			search(tree);
		} while(results.length < 2 && errorLevel < text.length * 0.5);
		return errorLevel + "\n" + results.sort(sortResult).join('\n');
		
		function sortResult(a,b){
			return Number(a.split('\t')[0]) - Number(b.split('\t')[0]);
		}
		function search(thisTree){
			var str = tree2str(tree);
			var diff = diffText(str);
			for(var i=0;i<pattern.length;i++){
				var diff1 = tryPattern(thisTree,i);
				if(diff1 < diff){
					checkFillings(thisTree);
					//diff0 = diff1;
				}
			}
			thisTree.splice(0,thisTree.length);
			checkFillings([]);
			return diff;
		}
		function tryPattern(thisTree,id){
			thisTree.splice(0,thisTree.length);
			thisTree.push(id);
			var patte = pattern[id];
			var re = /\./g;
			var resu;
			while((resu = re.exec(patte)) !== null){
				thisTree.push([]);
			}
			str = tree2str(tree);
			return diffText(str);
		}
		function checkFillings(thisTree){
			for(var i=1;i<thisTree.length;i++){
				fillings.push(thisTree[i]);
			}
			if(fillings.length !== 0){
				var fill=fillings.pop();
				search(fill);
				fillings.push(fill);
			}else{
				var str = tree2str(tree);
				if(!(str in resultIn)){
					results.push(diffText(str,text) + "\t" + str);
					resultIn[str]=1;
				}
			}
			for(var i=1;i<thisTree.length;i++){
				fillings.pop();
			}
		}
		function tree2str(tree){
			if(tree.length == 0){
				return ".";
			}else{
				var cnt=0;
				return pattern[tree[0]].replace(/\./g,function(){
					cnt++;
					return tree2str(tree[cnt]);
				})
			}
		}
		function diffText(str){
			if(str in diffCache){
				return diffCache[str];
			}
			str = str.replace(/\./g,"");
			var dp = [], leftup, min, min2;
			for(var x=0;x<=str.length;x++){
				dp.push(x * text.length);
			}
			for(var y=0;y<text.length;y++){
				leftup = dp[0];
				dp[0] = (y+1) * errorLevel;
				for(var x=0;x<str.length;x++){
					min = Math.min(
						dp[ x ] + text.length,
						dp[x+1] + errorLevel,
						leftup + (str[x]===text[y] ? 0 :
						errorLevel + text.length)
					);
					leftup = dp[x+1];
					dp[x+1] = min;
				}
			}
			return dp[str.length];
		}
	}
</script>