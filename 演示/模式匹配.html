<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<input style="width:100%;font-size:20px;" type="text" id="inn" />
<textarea style="width:100%;height:90%;font-size:20px;" type="text" id="out"></textarea>
<script>
	var inn = document.getElementById("inn");
	var out = document.getElementById("out");
	inn.addEventListener('keydown',function(event){
		setTimeout(function(){
			try{
				out.style.color = "black";
				out.value = match(inn.value);
			}catch(e){
				out.style.color = "red";
				out.value = e.message;
			}
		},0);
	});
	out.addEventListener('focus',function(event){
		out.blur();
	});
	var pattern = [
		"if . then .",
		"if . then . else .",
		". and .",
		". or .",
		"not .",
		"(.)",
		".+.",
		".-.",
		".*.",
		"./.",
		".?.:.",
	];

	function match(text){
		var tree = [];
		var fillings = [];
		var diffCache;
		var resultIn;
		var results;
		var errorLevel = -1/2;
		do {
			errorLevel += 1;
			diffCache = {};
			resultIn = {};
			results = [];
			search(tree);
		} while(results.length < 2 && errorLevel < text.length * 0.2);
		return errorLevel + "\n" + results.sort(sortResult).join('\n');
		
		function sortResult(a,b){
			return Number(a.split('\t')[0]) - Number(b.split('\t')[0]);
		}
		function search(thisTree){
			var str = tree2str(tree);
			var diff = diffText(str);
			for(var i=0;i<pattern.length;i++){
				var diff1 = tryPattern(thisTree,i);
				if(diff1 < diff){
					checkFillings(thisTree);
					//diff0 = diff1;
				}
			}
			thisTree.splice(0,thisTree.length);
			checkFillings([]);
			return diff;
		}
		function tryPattern(thisTree,id){
			thisTree.splice(0,thisTree.length);
			thisTree.push(id);
			var patte = pattern[id];
			var re = /\./g;
			var resu;
			while((resu = re.exec(patte)) !== null){
				thisTree.push([]);
			}
			str = tree2str(tree);
			return diffText(str);
		}
		function checkFillings(thisTree){
			for(var i=1;i<thisTree.length;i++){
				fillings.push(thisTree[i]);
			}
			if(fillings.length !== 0){
				var fill=fillings.pop();
				search(fill);
				fillings.push(fill);
			}else{
				var str = tree2str(tree);
				if(!(str in resultIn)){
					results.push(diffText(str,text) + "\t" + str);
					resultIn[str]=1;
				}
			}
			for(var i=1;i<thisTree.length;i++){
				fillings.pop();
			}
		}
		function tree2str(tree){
			if(tree.length == 0){
				return ".";
			}else{
				var cnt=0;
				return pattern[tree[0]].replace(/\./g,function(){
					cnt++;
					return tree2str(tree[cnt]);
				})
			}
		}
		function diffText(str){
			if(str in diffCache){
				return diffCache[str];
			}
			str = str.replace(/\./g,"");
			var dp = [], leftup, min, min2;
			for(var x=0;x<=str.length;x++){
				dp.push(x * text.length);
			}
			for(var y=0;y<text.length;y++){
				leftup = dp[0];
				dp[0] = (y+1) * errorLevel;
				for(var x=0;x<str.length;x++){
					min = Math.min(
						dp[ x ] + text.length,
						dp[x+1] + errorLevel,
						leftup + (str[x]===text[y] ? 0 :
						errorLevel + text.length)
					);
					leftup = dp[x+1];
					dp[x+1] = min;
				}
			}
			return dp[str.length];
		}
	}
</script>