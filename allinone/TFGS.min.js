!function(){try{let E;if("__TFGS$GjVPnZEHRf"in window)throw new Error("TFGS 已经安装");(E=window.__TFGS$GjVPnZEHRf={menu:{}}).menu.menuwin=null,E.menu.modi=!1,window.addEventListener("beforeunload",function(e){if(E.menu.modi)return e.preventDefault(),e.returnValue=""}),E.menu.setmodi=function(n){if(n!==E.menu.modi){let t=E.menu.buttons;for(var o in t){let e;switch(o){case"edit":continue;case"save":case"cancel":e=!1;break;default:e=!0}t[o].classList[n===e?"add":"remove"]("tfgsDisable")}E.menu.menuwin.title=n?"TFGS 选项 (未保存)":"TFGS 选项",E.menu.menuwin.canMinimize=!n,E.menu.menuwin._refresh(),E.menu.modi=n}},E.menu.create=function(){if(null===E.menu.menuwin){let e=E.window.create({title:"TFGS选项",canMinimize:!0,canClose:!1,x:50,y:50,width:400,height:300,minWidth:200,minHeight:100,minimizeWidth:100}),t=(e.minimize(),e.innerDiv),n=(t.innerHTML=`
<div class="tfgsMenuContent"></div>
<div class="tfgsMenuButtons">
	<span class="tfgsButton">导出</span>
	<span class="tfgsButton">导入</span>
	<span class="tfgsButton tfgsDisable">编辑文本</span>
	<span class="tfgsButton tfgsRight">显示日志</span>
	<span class="tfgsButton tfgsRight tfgsDisable">取消更改</span>
	<span class="tfgsButton tfgsDisable">保存更改</span>
</div>
`,E.menu.contentdiv=t.children[0]);var l=E.menu.buttondiv=t.children[1];let o=E.menu.buttons={},i=(o.export=l.children[0],o.import=l.children[1],o.edit=l.children[2],o.log=l.children[3],o.cancel=l.children[4],o.save=l.children[5],o.export.addEventListener("click",function(){E.menu.modi||E.data.export()}),o.import.addEventListener("click",function(){E.menu.modi||E.data.import().catch(E.error)}),o.edit.addEventListener("click",function(){E.menu.modi||E.data.edit().then(E.data.save).then(E.menu.load).catch(E.error)}),o.log.addEventListener("click",function(){E.menu.modi||E.log.create()}),!1);e.onResize=function(){i!==e.isMinimize&&(e.isMinimize?E.menu.modi&&e.restore():E.menu.load(),i=e.isMinimize)},o.save.addEventListener("click",function(){if(E.menu.modi)try{E.menu.save().then(function(){E.menu.load(),E.menu.setmodi(!1)}).catch(E.error)}catch(e){E.error(e)}}),o.cancel.addEventListener("click",function(){if(E.menu.modi&&confirm("取消更改？"))try{E.menu.load(),E.menu.setmodi(!1)}catch(e){alert(e.message)}});var a,s=E.func.list;let r=E.menu.list={};for(a in s){var c=s[a];let e=E.element.create("div","tfgsMenuFunc"),o=(e.innerHTML=`
<div class="tfgsMenuFuncTitle">
	<input type="checkbox"></input>
	<span class="tfgsMenuFuncName"></span>
	<span class="tfgsMenuFuncInfo"></span>
</div>
<div class="tfgsMenuFuncOption"></div>
`,r[a]={});function u(e,t){return null!=e&&""!==e?e+t:""}o.enable=e.children[0].children[0],o.enable.addEventListener("change",function(){E.menu.setmodi(!0)}),o.option={},e.children[0].children[1].innerText=c.name,e.children[0].children[2].innerText=u(c.version," ")+u(c.author," ")+u(c.info,"");let i=e.children[1];o.optiondiv=i;var d,f=c.option;for(d in f){var p=f[d];let e,t;switch((e=E.element.create("label")).innerText=p.name,p.type){case"number":t=E.element.create("input",void 0,"tel");break;case"text":t=E.element.create("input");break;case"check":t=E.element.create("input",void 0,"checkbox");break;case"menu":for(var h in t=E.element.create("select"),p.menu){let e=E.element.create("option");e.innerText=p.menu[h],e.value=h,t.appendChild(e)}break;default:throw new Error("Unsupport type: "+p.type)}o.option[d]=t;let n=E.element.create("span","tfgsMenuFuncOptionOne");n.appendChild(e),n.appendChild(t),i.appendChild(n),t.addEventListener("input",function(){E.menu.setmodi(!0)}),t.addEventListener("paste",function(){E.menu.setmodi(!0)}),t.addEventListener("change",function(){E.menu.setmodi(!0)})}n.appendChild(e),o.enable.addEventListener("change",function(e){o.optiondiv.classList[o.enable.checked?"remove":"add"]("tfgsMenuFuncFold")})}E.menu.menuwin=e,E.menu.load()}},E.menu.save=function(){return E.data.setjson(E.menu._json()),E.data.save()},E.menu._json=function(){var t,n=E.func.list,o=E.menu.list;let i={};for(t in n){var r=n[t],l=o[t];let e=i[t]={};e.enable=l.enable.checked,e.option={};var a,s=r.option;for(a in s){var c=s[a],u=l.option[a];switch(c.type){case"number":e.option[a]=Number(u.value);break;case"text":e.option[a]=u.value;break;case"check":e.option[a]=u.checked;break;case"menu":e.option[a]=c.value[Number(u.value)];break;default:throw new Error("类型错误: "+c.type)}}}return JSON.stringify(i)},E.menu.load=function(){var e,t=E.func.list,o=E.data.list,i=E.menu.list;for(e in t){var r=t[e],l=o[e];let n=i[e];n.enable.checked=l.enable,n.optiondiv.classList[n.enable.checked?"remove":"add"]("tfgsMenuFuncFold");var a,s=r.option;for(a in s){let e=s[a],t=n.option[a];var c=l.option[a];switch(e.type){case"number":case"text":t.value=c;break;case"check":t.checked=c;break;case"menu":e.value.includes(c)&&(t.options[e.value.indexOf(c)].selected=!0);break;default:throw new Error("Unsupport type: "+e.type)}}}},E.menu.delete=function(){E.menu.menuwin.canClose=!0,E.menu.menuwin.close(),E.menu.menuwin=null},E.funcapi={},E.funcapi.log=function(e,t){console.log(e,t),E.log.add(e,"#000000",t)},E.funcapi.warn=function(e,t){console.warn(e,t),E.log.add(e,"#808000",t)},E.funcapi.onerror=function(e,t){console.error(e,t),E.log.add(e,"#E00000",t.message)},E.funcapi.error=function(e,t){console.error(e,t),E.log.add(e,"#E00000",t)},E.funcapi.info=function(e,t){console.info(e,t),E.log.add(e,"#2020F0",t)},E.funcapi.getoption=function(e){return E.data.list[e].option},E.funcapi.getdata=function(e){return E.data.list[e].data},E.funcapi.setdata=function(e,t){return E.data.list[e].data=t,E.data.save()},E.funcapi.alert=function(e,n){return new Promise(function(e,t){alert(n),e()})},E.funcapi.confirm=function(e,n){return new Promise(function(e,t){e(confirm(n))})},E.funcapi.prompt=function(e,n,o){return new Promise(function(e,t){e(prompt(n,o))})},E.funcapi.copy=function(n,o){return new Promise((t,e)=>{"clipboard"in navigator&&"writeText"in navigator.clipboard?navigator.clipboard.writeText(o).then(t).catch(function(e){E.funcapi.onerror(n,e),prompt("请复制以下内容",o),t()}):(prompt("请复制以下内容",o),t())})},E.funcapi.paste=function(n){return new Promise((t,e)=>{"clipboard"in navigator&&"readText"in navigator.clipboard?navigator.clipboard.readText().then(t).catch(function(e){E.funcapi.onerror(n,e),t(prompt("在下方粘贴:"))}):t(prompt("在下方粘贴:"))})},E.funcapi.blockly=function(t){let n=[];try{return window.ClipCCExtension.api.getBlockInstance()}catch(e){n.push(e);try{var o=E.funcapi.vm(t).runtime.scratchBlocks;if("object"==typeof o&&null!==o&&"getMainWorkspace"in o)return o;throw new Error("Invaild block")}catch(e){n.push(e);try{var i=E.funcapi.reactInternal(t,E.funcapi.selele(t,"blocks_blocks_")).return.return.return.return.return.stateNode.ScratchBlocks;if("object"==typeof i&&null!==i&&"getMainWorkspace"in i)return i;throw new Error("Invaild block")}catch(e){n.push(e);for(let e=0;e<n.length;e++)E.funcapi.error(t,`funcapi: block: 方法${e+1}错误:`),E.funcapi.onerror(t,n[e]);throw new Error("tfgs.funcapi.block: cannot find block")}}}},E.funcapi.workspace=function(e){return E.funcapi.blockly(e).getMainWorkspace()},E.funcapi.toolbox=function(e){return E.funcapi.workspace(e).getFlyout().getWorkspace()},E.funcapi.selele=function(e,t,n){return(void 0===n?document:n).querySelector(`[class*="${t}"]`)},E.funcapi.selall=function(e,t,n){return(void 0===n?document:n).querySelectorAll(`[class*="${t}"]`)},E.funcapi.selcss=function(e,t,n){e=E.funcapi.selele(e,t,n);if(null===e)return null;let o=e.classList;for(let e=0;e<o.length;e++)if(o[e].includes(t))return o[e];return null},E.funcapi.reactInternal=function(e,t){let n="__reactInternalInstance$",o="__reactFiber$",i=null;return Object.keys(t).forEach(function(e){e.slice(0,n.length)===n&&(i=e),e.slice(0,o.length)===o&&(i=e)}),null===i?void 0:t[i]},E.funcapi.store=function(t){let n=[];try{var e=E.funcapi.reactInternal(t,E.funcapi.selele(t,"gui_page-wrapper_")).child.stateNode.store;if("object"==typeof e&&null!==e&&"dispatch"in e)return e;throw new Error("Invaild store")}catch(e){n.push(e);try{var o=E.funcapi.reactInternal(t,E.funcapi.selele(t,"blocks_blocks_")).return.return.return.return.pendingProps.value.store;if("object"==typeof o&&null!==o&&"dispatch"in o)return o;throw new Error("Invaild store")}catch(e){n.push(e);for(let e=0;e<n.length;e++)E.funcapi.error(t,`funcapi: store: 方法${e+1}错误:`),E.funcapi.onerror(t,n[e]);throw new Error("tfgs.funcapi.store: cannot find store")}}},E.funcapi.gui=function(t){let n=[];try{return window.ClipCCExtension.api.getGuiInstance()}catch(e){n.push(e);try{var o=E.funcapi.reactInternal(t,E.funcapi.selele(t,"gui_page-wrapper_")).return.return.return.return.return.return.return.return.stateNode;if("object"==typeof o.props&&null!==o.props&&"vm"in o.props)return o;throw new Error("Invaild gui")}catch(e){n.push(e);for(let e=0;e<n.length;e++)E.funcapi.error(t,`funcapi: gui: 方法${e+1}错误:`),E.funcapi.onerror(t,n[e]);throw new Error("tfgs.funcapi.gui: cannot find gui")}}},E.funcapi.vm=function(t){let n=[];try{return window.ClipCCExtension.api.getVmInstance()}catch(e){n.push(e);try{var o=E.funcapi.gui(t).props.vm;if("object"==typeof o&&null!==o&&"runtime"in o)return o;throw new Error("Invaild vm")}catch(e){n.push(e);try{var i=E.funcapi.store(t).getState().scratchGui.vm;if("object"==typeof i&&null!==i&&"runtime"in i)return i;throw new Error("Invaild vm")}catch(e){n.push(e);for(let e=0;e<n.length;e++)E.funcapi.error(t,`funcapi: vm: 方法${e+1}错误:`),E.funcapi.onerror(t,n[e]);throw new Error("tfgs.funcapi.vm: cannot find vm")}}}},E.funcapi.paint=function(e){return E.funcapi.store(e).getState().scratchPaint},E.funcapi.currenttab=function(e){let t=E.funcapi.selele(e,"gui_is-selected_");return null===t?-1:Number(t.id.slice(-1))/2},E.funcapi.RESPECTnodownload_DO_NOT_DELETE=function(e){e=E.funcapi.gui(e);return"readOnly"in e.props&&!0===e.props.readOnly||"canSaveToLocal"in e.props&&!1===e.props.canSaveToLocal||"openSourceLevel"in e.props&&3!==e.props.openSourceLevel},E.funcapi._getapi=function(n){let t={};for(let e in E.funcapi)t[e]=function(){let t=[n];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);return E.funcapi[e].apply(E.funcapi,t)};return t},E.log={},E.log.list=[],E.log.dispIntv=null,E.log.add=function(e,t,n){for(E.log.list.push({name:e,color:t,log:n});500<E.log.list.length;)E.log.list.splice(0,1);E.log.changed=!0},E.log.clear=function(){E.log.list=[],E.log.changed=!0},E.log.displayInterval=function(n,o){return E.log.display(n,o),E.log.changed=!1,setInterval(function(){var e=n.scrollX,t=n.scrollY;E.log.changed&&(n.innerHTML="",E.log.display(n,o)&&E.log.logwin.flash(500,3,!0),E.log.changed=!1),n.scrollX=e,n.scrollY=t},100)},E.log.display=function(t,e){let n=!0;for(var o in t.classList.add("tfgsLogFormat"),E.log.list){o=E.log.list[o];if((null===e.name||e.name.includes(o.name))&&(null===e.color||e.color.includes(o.color))){let e=E.element.create("div");e.style.color=o.color,e.innerText=o.name+"\t"+o.log,t.appendChild(e),n=!1}}return!n},E.log.create=function(o,i){try{if(null!==E.log.dispIntv)return E.log.logwin.movetotop(),void E.log.logwin.flash(200,3,!1);let e=E.log.logwin=E.window.create({title:"日志",x:"number"==typeof o?o:20,y:"number"==typeof i?i:20,width:200,height:200,minWidth:100,minHeight:50,minimizeWidth:70}),t=e.innerDiv;t.innerHTML=`
<div class="tfgsLogContent"></div>
<div class="tfgsLogButtons">
	<span class="tfgsButton tfgsRight">清空</span>
</div>
`;var r=t.children[0];let n=t.children[1].children[0];E.log.dispIntv=E.log.displayInterval(r,{name:null,color:null}),n.addEventListener("click",function(){E.log.clear()}),e.onClose=function(){clearInterval(E.log.dispIntv),t.remove(),E.log.dispIntv=null}}catch(e){E.error(e)}},E.storezip={},E.storezip.create=function(){let a=[];function s(e){e.forEach(e=>a.push(e))}function c(e){return new Uint8Array((new TextEncoder).encode(e))}function u(e){var t;return"object"!=typeof(e=null==e?new Date:e)&&(t=e,(e=new Date).setTime(Date.parse(t))),(e="Date"===e.constructor.name?{year:e.getYear()-80,month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds()}:e).second>>>1&31|(63&e.minute)<<5|(31&e.hour)<<11|(31&e.date)<<16|(15&e.month)<<21|(127&e.year)<<25}function d(e){a.push(255&e),a.push(e>>>8&255)}function f(e){a.push(255&e),a.push(e>>>8&255),a.push(e>>>16&255),a.push(e>>>24&255)}let p=[80,75,3,4,10,0,0,0,0,0],o=[80,75,1,2,10,0,10,0,0,0,0,0],r=[80,75,5,6,0,0,0,0],h=[],n=function(){let t=[];for(i=0;i<256;i++){let e=i;for(j=0;j<8;j++)1&e?e=e>>>1^3988292384:e>>>=1;t.push(e)}return t}();function m(e){"string"==typeof e&&(e=c(e));let t=4294967295;return e.forEach(e=>{t=t>>>8^n[255&(t^e)]}),(t^=4294967295)<0?t+4294967296:t}return{crc32:m,str2uint:c,todatetime:u,begin:function(){a=[]},addfile:function(e,t,n,o){"string"==typeof(t=null==t?[]:t)&&(t=c(t)),65535<(n="string"==typeof(n=null==n?[]:n)?c(n):n).length&&(E.funcapi.warn(e,"压缩包注释太长(最多65535个字节)"),n=n.slice(0,65535)),"number"!=typeof o&&(o=u(o));var i=a.length,r=m(t),l=c(e);if(65535<l.length)throw E.funcapi.error(e,"压缩包文件名太长(最多65535个字节)"),new Error("File name too long");s(p),f(o),f(r),f(t.length),f(t.length),d(l.length),d(0),s(l),s(t),h.push({uname:l,size:t.length,offs:i,crc:r,cint:n,datetime:o})},end:function(e){65535<(e="string"==typeof(e=null==e?[]:e)?c(e):e).length&&(e=e.slice(0,65535));var t=a.length,n=(h.forEach(e=>{s(o),f(e.datetime),f(e.crc),f(e.size),f(e.size),d(e.uname.length),d(0),d(e.cint.length),d(0),d(0),f(32),f(e.offs),s(e.uname),s(e.cint)}),a.length-t);return s(r),d(h.length),d(h.length),f(n),f(t),d(e.length),s(e),a}}},E.drag={},E.drag.setdrag=function(o,i){function e(e){var t,n=i.onStart(e);if(null!==n)return t=H(),s=t,r=t.x-n.x,l=t.y-n.y,a="click",window.addEventListener("mousemove",c),o.addEventListener("mousemove",c),window.addEventListener("mouseup",u),o.addEventListener("mouseup",u),window.addEventListener("mouseleave",u),window.addEventListener("blur",u),o.addEventListener("touchmove",c),o.addEventListener("touchend",u),e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)}let r,l,a,s,c=function(e){var t=H();return s.x===t.x&&s.y===t.y||(i.onMove(t.x-r,t.y-l,e),s=t,a="drag"),e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)},u=function(e){return i.onEnd(a,e),window.removeEventListener("mousemove",c),o.removeEventListener("mousemove",c),window.removeEventListener("mouseup",u),o.removeEventListener("mouseup",u),window.removeEventListener("mouseleave",u),window.removeEventListener("blur",u),o.removeEventListener("touchmove",c),o.removeEventListener("touchend",u),e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)};return o.addEventListener("mousedown",e),o.addEventListener("touchstart",e),function(){o.removeEventListener("mousedown",e),o.removeEventListener("touchstart",e)}},E.window={},E.window.zIndex=1e6,E.window.create=function(e){let o={titleDiv:null,innerDiv:null,windowDiv:null,resizeDiv:null,x:NaN,y:NaN,width:400,height:300,minHeight:0,minWidth:100,minimizeWidth:100,title:"",haveLogo:!0,canMinimize:!0,canMaximize:!0,canClose:!0,canResize:!0,canMove:!0,onClose:function(){},onResize:function(){},onMove:function(){},isMinimize:!1,isMaximize:!1,posRestore:{},flashMode:!1,flashTimer:-1,_rememberPos:function(){this.isMinimize||this.isMaximize||(this.posRestore.x=this.x,this.posRestore.y=this.y,this.posRestore.width=this.width,this.posRestore.height=this.height)},minimize:function(){this._rememberPos(),this.isMinimize=!0,this.isMaximize=!1,this._refresh(),this.onResize(),this.onMove()},maximize:function(){this._rememberPos(),this.isMinimize=!1,this.isMaximize=!0,this._refresh(),this.onResize(),this.onMove()},restore:function(){(this.isMinimize||this.isMaximize)&&(this.isMaximize&&(this.x=this.posRestore.x,this.y=this.posRestore.y),this.width=this.posRestore.width,this.height=this.posRestore.height,this.isMinimize=!1,this.isMaximize=!1,this._refresh(),this.onResize(),this.onMove())},movetotop:function(){this.windowDiv.style.zIndex=++E.window.zIndex,this.flashMode&&(this.windowDiv.classList.remove("tfgsEmergency"),this.flashMode=!1),-1!==this.flashTimer&&(clearInterval(this.flashTimer),this.flashTimer=-1)},close:function(){!1!==this.onClose()&&(this.windowDiv.remove(),this.windowDiv=null,window.removeEventListener("resize",t._resizeCallback))},resize:function(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this._refresh(),this.onResize())},move:function(e,t){e===this.x&&t===this.y||(this.x=e,this.y=t,this._refresh(),this.onMove())},flash:function(e,t,n){-1!==this.flashTimer&&clearInterval(this.flashTimer),this.windowDiv.classList.add("tfgsEmergency");let o=!0,i=this;this.flashTimer=setInterval(function(){0<t?o?(i.windowDiv.classList.remove("tfgsEmergency"),o=!1,t--):(i.windowDiv.classList.add("tfgsEmergency"),o=!0):(n&&(i.windowDiv.classList.add("tfgsEmergency"),o=!0),clearInterval(i.flashTimer),i.flashTimer=-1),i.flashMode=o},e)},_refresh:function(){var l=window.innerWidth,a=window.innerHeight;if(this.isMaximize)this.x=0,this.y=0,this.width=l,this.height=a;else{let e=this.minWidth+6,t=this.minHeight+26,n=this.x,o=this.y,i=this.width,r=this.height;this.isMinimize?(i=this.minimizeWidth+6,r=26):(i<e&&(i=e),r<t&&(r=t),i>l&&(i=l),r>a&&(r=a));var s=n+i,c=o+r;isNaN(n)&&(n=Math.floor(Math.random()*(l-i))),isNaN(o)&&(o=Math.floor(Math.random()*(a-r))),n<0&&(n=0),o<0&&(o=0),l<s&&(n-=s-l),a<c&&(o-=c-a),this.x=n,this.y=o,this.width=i,this.height=r}let e=this.windowDiv.style;e.left=this.x+"px",e.top=this.y+"px",e.width=this.width+"px",e.height=this.height+"px",A(this.titleDiv.children[0],!this.isMinimize&&this.haveLogo),this.titleDiv.children[1].innerText=this.title,A(this.titleDiv.children[2],!this.isMinimize&&this.canMinimize),A(this.titleDiv.children[3],this.isMaximize),A(this.titleDiv.children[4],!this.isMinimize&&!this.isMaximize&&this.canMaximize),A(this.titleDiv.children[5],this.canClose),A(this.innerDiv,!this.isMinimize),A(this.resizeDiv,!this.isMinimize&&!this.isMaximize&&this.canResize)}},t=(o=Object.assign(o,e),E.element.create("div","tfgsWindow"));t.innerHTML=`
<div class="tfgsWindowTitle">
	<span>≡</span>
	<span class="tfgsWindowText"></span>
	<span>_</span>
	<span>▭</span>
	<span>□</span>
	<span>✕</span>
</div>
<div class="tfgsWindowContent"></div>
<div class="tfgsWindowResize"></div>
`,document.body.appendChild(t),t.style.zIndex=++E.window.zIndex,t._resizeCallback=function(){o._refresh(),o.onResize()},window.addEventListener("resize",t._resizeCallback);var e=t.children[0],n=t.children[1],i=t.children[2];let r=e.children;t.addEventListener("mousedown",function(e){o.movetotop()},!0),r[2].addEventListener("click",function(e){o.minimize()}),r[3].addEventListener("click",function(e){o.restore()}),r[4].addEventListener("click",function(e){o.maximize()}),r[5].addEventListener("click",function(e){o.close()});var l={onStart:function(e){return o.isMaximize?null:(o.movetotop(),{x:o.x,y:o.y})},onMove:function(e,t,n){o.canMove&&o.move(e,t)},onEnd:function(e,t){"click"===e&&o.isMinimize&&o.restore()}};return E.drag.setdrag(r[0],l),E.drag.setdrag(r[1],l),E.drag.setdrag(i,{onStart:function(e){return{x:o.width,y:o.height}},onMove:function(e,t,n){o.resize(e,t)},onEnd:function(e,t){}}),o.windowDiv=t,o.titleDiv=e,o.innerDiv=n,o.resizeDiv=i,o._refresh(),o.flash(300,1,!1),o},E.data={},E.data.list={},E.data.getjson=function(){return JSON.stringify(E.data.list)},E.data.setjson=function(e){let n=JSON.parse(e),o=("object"==typeof n&&null!==n||(n={}),{});for(var i in E.func.list){var r="object"==typeof n[i]||null===n[i]?n[i]:{};let e=o[i]={};e.enable=r.enable,"boolean"!=typeof e.enable&&(e.enable=void 0),e.data=r.data;var l,a="object"==typeof r.option||null===r.option?r.option:{};let t={};for(l in E.func.list[i].option)t[l]=a[l];e.option=t}E.data.list=o,E.func.datachange()},E.data.load=function(){return new Promise(function(e,t){e(localStorage.getItem("-tfgs-"))}).then(E.data.setjson)},E.data.save=function(){return new Promise(function(e,t){localStorage.setItem("-tfgs-",E.data.getjson()),e()})},E.data.import=function(){return new Promise(function(n,e){let o=document.createElement("input");o.type="file",o.addEventListener("change",function(e){if(0<o.files.length){let t=new FileReader;t.addEventListener("load",function(e){n(t.result.toString())}),t.readAsBinaryString(o.files[0])}}),o.click()}).then(E.data.setjson).then(E.data.save).then(E.menu.load)},E.data.export=function(){let o=E.data.getjson();return new Promise(function(e,t){let n=document.createElement("a");n.href="data:text/plain;charset:utf-8,"+o,n.download="tfgs-options.json",n.click(),e()})},E.data.edit=function(){return E.funcapi.prompt("-tfgs-","编辑配置文本",E.data.getjson()).then(function(e){null!==e&&E.data.setjson(e)})},E.element={},E.element.create=function(e,t,n){let o=document.createElement(e);return void 0!==t&&(o.className=t),o.className=t,void 0!==n&&(o.type=n),o},E.error=function(e){throw alert(e.message),console.error(e),e},E.func={},E.func.list={},E.func.add=function(e){if(e.id in E.func.list)throw new Error("id used: "+e.id);E.func.list[e.id]={name:e.name,info:e.info,default:e.default,option:e.option,onenable:e.onenable,ondisable:e.ondisable,onoption:e.onoption,enable:!1}},E.func.default=function(t){let n={};var o,i=E.func.list;for(o in i){var r,l=i[o].option;let e={};for(r in l)e[r]=l[r].default;n[o]={enable:i[o].default,option:e,data:!t&&o in E.data.list?E.data.list[o].data:void 0}}E.data._default(n)},E.func.datachange=function(){for(var t in E.func.fixoption(),E.func.list){let e=E.func.list[t];var n=E.data.list[t].enable;if(e.enable!==n){try{e[n?"onenable":"ondisable"](E.funcapi._getapi(t))}catch(e){E.funcapi.error(t,"Error: "+e.message),console.error(e)}e.enable=n}else if(n)try{e.onoption(E.funcapi._getapi(t))}catch(e){E.funcapi.error(t,"Error: "+e.message),console.error(e)}}},E.func.fixoption=function(){var n,e=E.func.list;for(n in e){"boolean"!=typeof E.data.list[n].enable&&(E.data.list[n].enable=e[n].default);var o,i=e[n].option;for(o in i){let e=i[o],t=E.data.list[n].option;switch(e.type){case"text":null!==t[o]&&void 0!==t[o]||(t[o]=e.default),"string"!=typeof t[o]&&(t[o]=String(t[o])),"maxlength"in e&&t[o].length>e.maxlength&&(t[o]=t[o].slice(0,e.maxlength));break;case"number":"number"!=typeof t[o]&&(t[o]=Number(t[o])),isNaN(t[o])&&(t[o]=e.default),t[o]<e.min&&(t[o]=e.min),t[o]>e.max&&(t[o]=e.max);break;case"check":"boolean"!=typeof t[o]&&(t[o]=e.default);break;case"menu":e.value.includes(t[o])||(t[o]=e.default)}}}};{let t,n=null,l=null,o="?",a=null,e=-1,i="?";function r(){if(-1===e)e=setInterval(r,1e3);else{if(null===a){if(null===(n=document.getElementById("gandi-terminal")))return;l=n.children[1];let e=window.getComputedStyle(l),o=E.element.create("span","tfgsCCWtermSpan"),i=Number(e.width.slice(0,-2))+20,r=Number(e.height.slice(0,-2))+20;t.log(e.width),t.log(e.height),a=E.window.create({title:"wterm",canClose:!1,width:i+6,height:r+26,onResize:function(){let e=window.getComputedStyle(this.innerDiv);var t=Number(e.width.slice(0,-2)),n=Number(e.height.slice(0,-2));o.style.setProperty("--scale",Math.min(t/i,n/r))}}),o.innerHTML="<span></span>",o.children[0].appendChild(l),o.style.setProperty("--termWidth",i+"px"),o.style.setProperty("--termHeight",r+"px"),a.innerDiv.appendChild(o),n.style.display="none"}if(a.title=n.children[0].children[0].innerText,a._refresh(),o!==n.style.visibility)if(o=n.style.visibility,t.log("visibility: "+o),"visible"!==n.style.visibility)switch(t.getoption().mode){case"respect":a.windowDiv.style.visibility="hidden";break;case"minmax":case"minshow":a.minimize()}else{switch(a.windowDiv.style.visibility="visible",a.movetotop(),t.getoption().mode){case"respect":break;case"minmax":a.restore()}a.flash(200,3,!0)}}}function s(){return document.getElementsByClassName("xterm-helper-textarea")[0]}function c(t){for(let e=0;e<t.data.length;e++)this.dispatchEvent(new KeyboardEvent("keypress",{charCode:t.data.codePointAt(e)})),t.preventDefault()}function u(e){e.preventDefault()}function d(){let e=s();void 0!==e&&(e.addEventListener("compositionend",c),e.addEventListener("input",c),e.addEventListener("keypress",u))}function f(){let e=s();void 0!==e&&(e.removeEventListener("compositionend",c),e.removeEventListener("input",c),e.removeEventListener("keypress",u))}E.func.add({id:"ccwterm",name:"将ccw控制台放入tfgs窗口",info:"这个东西，我们叫它'Terminal'(终端)，微软叫它'Console'(控制台)，用着xterm又叫它控制台的ccw是",default:!1,option:{mode:{type:"menu",name:"响应控制台消息",menu:["尊重显示和隐藏操作","将显示/隐藏理解为还原/最小化","显示时闪烁,隐藏时最小化","忽略隐藏请求"],value:["respect","minmax","minshow","ignore"],default:"respect"},fixinput:{type:"check",name:"修复中文/手机输入异常",default:"true"}},onenable:function(e){t=e,o="?",i=t.getoption().mode,r(),(t.getoption().fixinput?d:f)()},ondisable:function(){-1!==e&&(clearInterval(e),e=-1),null!==a&&(a.close(),a=null),null!==n&&(n.style.display="block",n.appendChild(l)),f()},onoption:function(){t.getoption().mode!==i&&(o="?",i=t.getoption().mode),(t.getoption().fixinput?d:f)()}})}{let a,o=!1,s,i,r=-1,l=null,c=null,u={};function p(e,t,n){let o=a.selele("blocklyContextMenu");if(null!==o){let e=null===t?null:t.id;u.copypaste&&n===s&&!a.RESPECTnodownload_DO_NOT_DELETE()&&(null!==e?(h("复制这个积木",function(){m(e,!1,!0),o.remove()},o),h("复制这组积木",function(){m(e,!0,!1),o.remove()},o)):(h("复制全部积木",function(){m(null,!0,!1),o.remove()},o),h("粘贴积木文本",function(){a.paste().then(function(e){let t=a.blockly();var e=t.Xml.textToDom(e),n=t.Xml.domToWorkspace(e,s);if(0===n.length)throw new Error("粘贴失败");var o,e=s.getMetrics(),i=e.viewLeft+15;let r=e.viewTop+15;for(let t=0;t<n.length;t++){let e=s.getBlockById(n[t]);null===e.getParent()&&(o=e.getRelativeToSurfaceXY(),e.moveBy(i/s.scale-o.x,r/s.scale-o.y),r+=(e.getHeightWidth().height+30)*s.scale)}}),o.remove()},o)))}}function h(e,t,n){let o=E.element.create("div","goog-menuitem"),i=(o.setAttribute("role","menuitem"),o.style.userSelect="none",E.element.create("div","goog-menuitem-content"));i.innerText=e,o.appendChild(i),o.addEventListener("click",t),n.parentElement.style.height="100000px",n.appendChild(o)}function m(o,i,r){try{let t=a.blockly();var l=t.Xml.workspaceToDom(s);let n;if(null===o)n=t.Xml.domToText(l,s);else{let e=function t(e,n){if(e.getAttribute("id")===n)return e;var o=e.children;for(let e=0;e<o.length;e++){var i=t(o[e],n);if(null!==i)return i}return null}(l,o);for(;null!==e&&"block"!==e.tagName.toLowerCase();)e=e.parentElement;if(null===e)throw new Error("复制失败:找不到积木");if(r){let t=e.children;for(let e=0;e<t.length;e++)"next"===t[e].tagName.toLowerCase()&&(t[e].remove(),e--)}if(i)for(;null!==e.parentElement&&("block"===e.parentElement.tagName.toLowerCase()||"next"===e.parentElement.tagName.toLowerCase());)e=e.parentElement;n="<xml>"+t.Xml.domToText(e,s)+"</xml>"}a.copy(n)}catch(e){a.onerror(e)}}E.func.add({id:"blockmenu",name:"积木右键菜单",info:"在右键菜单中添加各种功能",default:!1,option:{copypaste:{type:"check",name:"复制，粘贴积木为文本",default:!0}},onenable:function(e){a=e,u=a.getoption(),function t(n){o=!0;try{i=a.blockly(),s=a.workspace(),null===l&&(l=s.showContextMenu_,s.showContextMenu_=function(e){var t=l.apply(this,arguments);try{o&&p(0,null,s)}catch(e){a.onerror(e)}return t}),null===c&&(c=i.BlockSvg.prototype.showContextMenu_,i.BlockSvg.prototype.showContextMenu_=function(e){var t=c.apply(this,arguments);try{o&&p(0,this,this.workspace)}catch(e){a.onerror(e)}return t}),a.log("打开")}catch(e){return a.onerror(e),a.log("启动失败次数: "+(n+1)),r=setTimeout(function(){t(n+1)},500)}}(1)},ondisable:function(){o=!1,-1!==r&&(clearTimeout(r),r=-1),a.log("关闭")},onoption:function(){u=a.getoption()}})}{let s=null,t=-1,n=null;function P(){if(null===n){n=E.window.create({title:"forceColor",haveLogo:!1,canClose:!1,canMaximize:!1,x:100,y:80,width:250,height:160,minWidth:120,minHeight:120});let e=E.element.create("div","tfgsForcecolorWin"),a=(e.innerHTML=`
类型: <select>
	<option value="0">填充颜色</option>
	<option value="1">轮廓颜色</option>
</select><br/>
颜色1: <input type="text" value="#00ff00"></input><br/>
颜色2: <input type="text" value="#ff0000"></input><br/>
混合模式: <select>
	<option value="SOLID">■</option>
	<option value="VERTICAL">↓</option>
	<option value="HORIZONTAL">→</option>
	<option value="RADIAL">○</option>
</select><br/>
<input type="button" value="设置"></input>
<pre>颜色格式: #RRGGBB 或者 rgb(红色, 绿色, 蓝色)
透明颜色: #RRGGBBAA 或者 rgba(红色, 绿色, 蓝色, 不透明度)</pre>
`,e.children);a[8].addEventListener("click",function(){try{{var o=Number(a[0].value),i={primary:a[2].value,secondary:a[4].value,gradientType:a[6].value},r=s.selele("paint-editor_editor-container-top_").children[1].children[0].children[o];let e=s.reactInternal(r).return.return.return.stateNode,t=(e.handleChangeGradientType(i.gradientType),e.props.onChangeColorIndex(0),e.handleChangeColor(i.primary),"SOLID"!==i.gradientType&&(e.props.onChangeColorIndex(1),e.handleChangeColor(i.secondary)),e.handleCloseColor(),e.props.onUpdateImage(),s.vm()),n=E.funcapi.paint().color;var l=1===o?"strokeColor":"fillColor";n[l].gradientType=i.gradientType,n[l].primary=i.primary,n[l].secondary=i.secondary,t.refreshWorkspace()}}catch(e){s.onerror(e)}}),n.innerDiv.appendChild(e)}}E.func.add({id:"forcecolor",name:"强行设定颜色",onenable:function(e){s=e,-1===t&&(t=setInterval(P,100))},ondisable:function(){-1!==t&&(clearInterval(t),t=-1),null!==n&&(n.close(),n=null)},onoption:function(){}})}{let c={},t,d=null,f=!1,p=!1,h=!1,s=0,u=0,m=!1,g=0,v=0,b=0,y=null,w=-1,x=-1,k=!1,i=-1;function n(e){p=e.ctrlKey,h=e.altKey,f=e.shiftKey}function L(n){var e,o=d.innerDiv.children[0].children;for(let t=0;t<o.length;t++){let e=o[t];e.style.display=n===t?"flex":"none"}2===(i=n)&&0!==(e=o[2].children).length&&(S(e[0],c.joyleft,c.joyleftcustom),S(e[1],c.joyright,c.joyrightcustom))}function o(){var e=d.innerDiv.children[0].children,t=e[0];let n=e[1],o=e[2],i=(z(t,["`1234567890-=⌫\n⇄qwertyuiop[]\\\n asdfghjkl';↵\n⇧zxcvbnm,./ \n⌃⌥␣←↑↓→⌬","1234567890\nqwertyuiop\nasdfghjkl\nzxcvbnm↑↵\n⌬␣←↓→"][c.fullkey?0:1],1,!0),n.innerHTML=`
<span class="tfgsJoystickMouseMove"></span>
<span>
	<span class="tfgsJoystickMouseClick">
		<svg width=20 height=30>
			<path d="
				M 1 10
				A 9 9 0 0 1 19 10
				L 19 20
				A 9 9 0 0 1 1 20
				Z
				M 1 15
				L 19 15
				M 10 1
				L 10 5
				M 8 7
				A 2 2 0 0 1 12 7
				L 12 9
				A 2 2 0 0 1 8 9
				Z
				M 10 11
				L 10 15
			" stroke=black stroke-width=1 fill=none />
			<path d="
				M 1 10
				A 9 9 0 0 1 10 1
				L 10 15
				L 1 15
			" stroke=none fill=black />
		</svg>
	</span>
	<span class="tfgsJoystickMouseClick">
		<svg width=20 height=30>
			<path d="
				M 1 10
				A 9 9 0 0 1 19 10
				L 19 20
				A 9 9 0 0 1 1 20
				Z
				M 1 15
				L 19 15
				M 10 1
				L 10 5
				M 8 7
				A 2 2 0 0 1 12 7
				L 12 9
				A 2 2 0 0 1 8 9
				Z
				M 10 11
				L 10 15
			" stroke=black stroke-width=1 fill=none />
			<path d="
				M 8 7
				A 2 2 0 0 1 12 7
				L 12 9
				A 2 2 0 0 1 8 9
			" stroke=none fill=black />
		</svg>
	</span>
	<span class="tfgsJoystickMouseClick">
		<svg width=20 height=30>
			<path d="
				M 1 10
				A 9 9 0 0 1 19 10
				L 19 20
				A 9 9 0 0 1 1 20
				Z
				M 1 15
				L 19 15
				M 10 1
				L 10 5
				M 8 7
				A 2 2 0 0 1 12 7
				L 12 9
				A 2 2 0 0 1 8 9
				Z
				M 10 11
				L 10 15
			" stroke=black stroke-width=1 fill=none />
			<path d="
				M 10 1
				A 9 9 0 0 1 19 10
				L 19 15
				L 10 15
			" stroke=none fill=black />
		</svg>
	</span>
	<span class="tfgsJoystickMouseClick">▲</span>
	<span class="tfgsJoystickMouseClick">▼</span>
	<span class="tfgsJoystickMouseSwitch">◎∷</span>
</span>`,n.children[0].onmousedown=n.children[0].ontouchstart=M,n.children[0].onmousemove=n.children[0].ontouchmove=M,n.children[0].onmouseleave=n.children[0].onmouseup=n.children[0].ontouchend=M,a(n.children[1].children[0],0),c.mousebuttons?(a(n.children[1].children[1],1),a(n.children[1].children[2],2)):(n.children[1].children[1].style.display="none",n.children[1].children[2].style.display="none"),l(n.children[1].children[3],-120),l(n.children[1].children[4],120),n.children[1].children[5].onmousedown=n.children[1].children[5].ontouchstart=function(e){this.style.background="grey"},n.children[1].children[5].onmouseup=n.children[1].children[5].ontouchend=function(e){this.style.background="inherit",L(2)},o.innerHTML='<span></span><span></span><span class="tfgsJoystickSwitch">⌨</span>',o.children);i[2].onmousedown=i[2].ontouchstart=function(){this.style.background="grey"},i[2].onmouseup=i[2].ontouchend=function(){this.style.background="inherit",L(0)},S(i[0],c.joyleft,c.joyleftcustom),S(i[1],c.joyright,c.joyrightcustom)}function l(e,n){function t(){var e=s,t=u;_(WheelEvent,e,t,"wheel",{deltaY:n/4,wheelDelta:-n})}let o=-1;e.onmousedown=e.ontouchstart=function(e){-1!==o&&clearInterval(o),t(),o=setInterval(t,50),this.style.background="grey"},e.onmouseleave=e.onmouseup=e.ontouchend=function(e){-1!==o&&clearInterval(o),this.style.background="inherit"}}function a(e,t){e.onmousedown=e.ontouchstart=function(e){T(s,u,"mousedown",{button:t}),this.style.background="grey"},e.onmouseleave=e.onmouseup=e.ontouchend=function(e){T(s,u,"mouseup",{button:t}),this.style.background="inherit"}}function M(e){let t;switch(e.type){case"mousedown":k=!0,this.style.background="grey",t=[{clientX:e.clientX,clientY:e.clientY}];break;case"mousemove":t=k?[{clientX:e.clientX,clientY:e.clientY}]:[];break;case"mouseup":case"mouseleave":k=!1,this.style.background="inherit",t=[];break;default:t=e.targetTouches}let n=0,o=0,i=(new Date).getTime();for(let e=0;e<t.length;e++)n+=t[e].clientX,o+=t[e].clientY;var r,l,a;null===y&&(y=E.element.create("span","tfgsJoystickCursor"),document.body.appendChild(y),y.innerHTML=`<svg>
	<defs>
		<filter id="fl" x="0" y="0" width="100" height="100">
			<feGaussianBlur in="SourceAlpha" stdDeviation="1" result="blur"/>
			<feOffset in="blur" dx="1" dy="1" result="offsetBlur"/>
			<feBlend in="SourceGraphic" in2="offsetBlur" mode="normal">
		</filter>
	</defs>
	<path d="
		M 0 0
		L 15 20
		L 10 21.67
		L 14 29.67
		L 9 31.33
		L 5 23.33
		L 0 25
		Z
	" stroke=black stroke-width=1 fill=white filter="url(#fl)" />
</svg>`),"touchmove"===e.type||"mousemove"===e.type&&k?(n/=t.length,o/=t.length,r=n-g,l=o-v,a=i-b,a=Math.sqrt(r*r+l*l)/(a/1e3),a=c.mousespeed*(a/(a+c.mouseaccer)),s+=r*a,u+=l*a,s<0&&(s=0),u<0&&(u=0),s>window.innerWidth-1&&(s=window.innerWidth-1),u>window.innerHeight-1&&(u=window.innerHeight-1),g=n,v=o,b=i,T(s,u,"mousemove",{})):(m=c.mouse2click&&1<t.length?(m||(T(s,u,"mousedown",{}),this.style.background="grey"),!0):(m&&(T(s,u,"mouseup",{}),this.style.background="inherit"),!1),0<t.length&&(g=n/t.length,v=o/t.length,b=i)),y.style.left=s-1+"px",y.style.top=u-1+"px"}function C(t,n){n=F(n,f);{n={key:n.cname,code:n.ccode,keyCode:n.ccode},t=new KeyboardEvent(t,Object.assign({view:window,ctrlKey:p,altKey:h,shiftKey:f,bubbles:!0,cancelable:!0},n));let e=document.activeElement;(e=null===e?window:e).dispatchEvent(t)}}function _(e,t,n,o,i){const r=new e(o,Object.assign({view:window,ctrlKey:p,altKey:h,shiftKey:f,clientX:t,clientY:n,bubbles:!0,cancelable:!0},i));let l=document.elementFromPoint(t,n),a=r.clientX,s=r.clientY;if(null!==l)for(;;){let e=null;var c;if("iframe"===l.tagName.toLowerCase()?(c=l.getBoundingClientRect(),a-=c.left,s-=c.top,e=l.contentWindow.document.elementFromPoint(a,s)):"mousedown"===o&&null!==l.shadowRoot&&void 0!==l.shadowRoot&&(e=l.shadowRoot.elementFromPoint(a,s)),null===e)break;l=e}let u=l=null===l?window:l;for(;null!==u&&u!==d.windowDiv;)u=u.parentElement;null===u&&(r.clientX=a,r.clientY=s,l.dispatchEvent(r))}function T(e,t,n,o){_(MouseEvent,e,t,n,o)}function z(t,n,o,i){for(var r in t.innerHTML="",n=n.split("\n")){var l,a=n[r].split("");let e=E.element.create("span");for(l in a){var s=a[l];e.appendChild(function(t,n,e){let o=E.element.create("span");var i=F(t,!1),r=F(t,!0);function l(){"Control"===a&&(p=!0),"Alt"===a&&(h=!0),"Shift"===a&&(f=!0),C("keydown",t)}let a=i.cname,s=r.cname;return"tfgsSwitch"===a?o.innerHTML=`<svg width=20 height=30>
	<path d="
		M 1 10
		A 9 9 0 0 1 19 10
		L 19 20
		A 9 9 0 0 1 1 20
		Z
		M 1 15
		L 19 15
		M 10 1
		L 10 5
		M 8 7
		A 2 2 0 0 1 12 7
		L 12 9
		A 2 2 0 0 1 8 9
		Z
		M 10 11
		L 10 15
	" stroke=black stroke-width=1 fill=none />
</svg>`:o.innerText=t+(a.toLowerCase()!==s.toLowerCase()&&e?"\n"+s:""),o.onmousedown=o.ontouchstart=function(e){"tfgsSwitch"!==a&&(-1!==w&&clearInterval(w),-1!==x&&clearTimeout(x),w=-1,x=-1,l(),"Shift"!==a&&"Alt"!==a&&"Control"!==a&&(x=setTimeout(function(){x=-1,l(),w=setInterval(l,c.keyInterval)},c.keyTimeout))),o.style.background="grey"},o.onmouseleave=o.onmouseup=o.ontouchend=function(e){"tfgsSwitch"!==a?(-1!==w&&clearInterval(w),-1!==x&&clearTimeout(x),w=-1,x=-1,"Control"===a&&(p=!1),"Alt"===a&&(h=!1),"Shift"===a&&(f=!1),C("keyup",t)):L(n),o.style.background="inherit"},e&&("Unidentified"===a&&(o.style.flexGrow=1.5),"Shift"===a&&(o.style.flexGrow=2),"Control"===a&&(o.style.flexGrow=2),"Enter"===a&&(o.style.flexGrow=1.5)," "===a&&(o.style.flexGrow=4)),"Unidentified"===a&&(o.style.visibility="hidden"),o}(s,o,i))}t.appendChild(e)}}function F(e,t){switch(e){case"⌫":ccode=8,cname="Backspace";break;case"⇄":ccode=9,cname="Tab";break;case"␣":ccode=32,cname=" ";break;case"↵":ccode=13,cname="Enter";break;case"⇧":ccode=0,cname="Shift";break;case"⌥":ccode=0,cname="Alt";break;case"⌃":ccode=0,cname="Control";break;case"←":ccode=37,cname="ArrowLeft";break;case"↑":ccode=38,cname="ArrowUp";break;case"→":ccode=39,cname="ArrowRight";break;case"↓":ccode=40,cname="ArrowDown";break;case" ":ccode=0,cname="Unidentified";break;case"⌬":ccode=0,cname="tfgsSwitch";break;default:ccode=e.toUpperCase().codePointAt(0),cname=t?"`1234567890-=[]\\';.,/".includes(e)?'~!@#$%^&*()_+{}|":<>?'["`1234567890-=[]\\';.,/".indexOf(e)]:e.toUpperCase():e.toLowerCase()}return{ccode:ccode,cname:cname}}function S(e,t,n){switch(n=n.replace(/\|/g,"\n").replace(new RegExp("\\{[^}]+\\}","g"),function(e){var t={"{space}":"␣","{enter}":"↵","{left}":"←","{up}":"↑","{down}":"↓","{right}":"→","{control}":"⌃","{shift}":"⇧","{alt}":"⌥","{tab}":"⇄","{backspace}":"⌫","{bar}":"|","{empty}":" ","{leftcurly}":"{","{rightcurly}":"}","{switch}":"⌬"};return e in t?t[e]:" "}),Math.floor(t/10)){case 1:{let l=["↑↓←→","WSAD","IKJL",n][t%10];e.innerHTML='<span class="tfgsJoystickJoystick"><span><span></span></span></span>';var r=e.getBoundingClientRect(),r=.8*Math.min(r.right-r.left,r.bottom-r.top);e.children[0].style.setProperty("--size",r+"px");let o=e.children[0].children[0],a=o.children[0],i=function(e,t){var e=e.getBoundingClientRect(),n=(e.left+e.right)/2,o=(e.top+e.bottom)/2;let i=(t="targetTouches"in t?t.targetTouches[0]:t).clientX-n,r=t.clientY-o;n=Math.sqrt(i*i+r*r),t=(e.right-e.left)/2/2;t<n?(i/=n,r/=n):(i/=t,r/=t),r<-.38?C("keydown",l[0]):C("keyup",l[0]),.38<r?C("keydown",l[1]):C("keyup",l[1]),i<-.38?C("keydown",l[2]):C("keyup",l[2]),.38<i?C("keydown",l[3]):C("keyup",l[3]),a.style.left=i*t+"px",a.style.top=r*t+"px"};E.drag.setdrag(o,{onStart:function(e){return i(o,e),{x:0,y:0}},onMove:function(e,t,n){i(o,n)},onEnd:function(e){for(let e=0;e<4;e++)C("keyup",l[e]);a.style.left="0px",a.style.top="0px"}});break}case 2:r=["FC\nZX","EQ\nR␣","UIO\nJKL","123\n456","⌃⇧\n⌥␣","↑↓{\n←→}\n| ",n][t%10];e.classList.add("tfgsJoystickJoystickKeyBoard"),z(e,r,0,!1);break;case 3:e.innerHTML='<span class="tfgsJoystickJoystickMouse"></span>',(e=e.children[0]).onmousedown=e.ontouchstart=M,e.onmousemove=e.ontouchmove=M,e.onmouseleave=e.onmouseup=e.ontouchend=M}}E.func.add({id:"joystick",name:"虚拟摇杆",info:"显示自定义虚拟摇杆",default:!1,option:{start:{type:"menu",name:"默认模式",menu:["键盘","鼠标","游戏手柄"],value:[0,1,2],default:2},fullkey:{type:"check",name:"键盘显示更多按键",default:!1},keyTimeout:{type:"number",name:"长按到自动连续按键的时间(毫秒)",min:50,max:5e3,default:600},keyInterval:{type:"number",name:"自动连续按键间隔(毫秒)",min:5,max:5e3,default:50},mousespeed:{type:"number",name:"鼠标指针速度",min:.5,max:20,default:5},mouseaccer:{type:"number",name:"鼠标指针减速",min:0,max:1e4,default:100},mouse2click:{type:"check",name:"放置两根手指模拟点击",default:!0},mousebuttons:{type:"check",name:"鼠标显示中键和右键",default:!1},joyleft:{type:"menu",name:"游戏手柄左侧布局",menu:["摇杆(上下左右)","摇杆(WSAD)","摇杆(IKJL)","摇杆(自定义)","键盘(FC|ZX)","键盘(EQ|R{space})","键盘(UIO|JKL)","键盘(123|456)","键盘({ctrl}{shift}|{alt}{space})","键盘({up}{down}{leftcurly}|{left}{right}{rightcurly})","键盘(自定义)","鼠标"],value:[10,11,12,13,20,21,22,23,24,25,26,30],default:10},joyright:{type:"menu",name:"游戏手柄右侧布局",menu:["摇杆(上下左右)","摇杆(WSAD)","摇杆(IKJL)","摇杆(自定义)","键盘(FC|ZX)","键盘(EQ|R{space})","键盘(UIO|JKL)","键盘(123|456)","键盘({ctrl}{shift}|{alt}{space})","键盘({up}{down}{leftcurly}|{left}{right}{rightcurly}|{bar}{empty})","键盘(自定义)","鼠标"],value:[10,11,12,13,20,21,22,23,24,25,26,30],default:20},joyleftcustom:{type:"text",name:"左侧自定义",default:"WSAD"},joyrightcustom:{type:"text",name:"右侧自定义",default:"IKJL"}},onenable:function(e){t=e,c=t.getoption();{window.addEventListener("keydown",n),window.addEventListener("keyup",n),f=!1,p=!1,h=!1,s=0,u=0,m=!1,g=0,v=0,b=0,y=null,w=-1,x=-1;let e=(d=E.window.create({title:"JoyStick",canClose:!1,canMaximize:!1,onResize:function(){var e;2===i&&0!==(e=d.innerDiv.children[0].children[2].children).length&&(S(e[0],c.joyleft,c.joyleftcustom),S(e[1],c.joyright,c.joyrightcustom))}})).innerDiv;return e.innerHTML=`
<div class="tfgsJoystick">
	<div class="tfgsJoystickKeyBoard"></div>
	<div class="tfgsJoystickMouse"></div>
	<div class="tfgsJoystickGamepad"></div>
</div>`,e.onmousedown=e.ontouchstart=function(e){d.movetotop(),e.preventDefault(),e.stopPropagation()},e.onmousemove=e.ontouchmove=function(e){e.preventDefault(),e.stopPropagation()},e.onmouseup=e.ontouchend=function(e){e.preventDefault(),e.stopPropagation()},L(c.start),void o()}},ondisable:function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",n),null!==d&&(d.close(),d=null),null!==y&&(document.body.removeChild(y),y=null)},onoption:function(){var e=t.getoption();e.fullkey!==c.fullkey||e.mouse2click!==c.mouse2click||e.mousebuttons!==c.mousebuttons||e.joyleft!==c.joyleft||e.joyright!==c.joyright||e.joyleftcustom!==c.joyleftcustom||e.joyrightcustom!==c.joyrightcustom?(c=e,o()):c=e}})}{let f,t=-1,p={},n={},o=!1,i=0;function g(n){var o=n.buttonid,e=n.enable;let i=n.addinner,r=n.removeinner;var l=n.styles,a=n.targetcss;let s=n.cssname,c=n.onadd,u=n.onremove;if(e){if(void 0!==p[o]&&(e=f.selele(a),p[o].parentElement!==e&&(p[o].remove(),(p[o]=void 0)!==s&&document.body.classList.remove(s),"function"==typeof u&&u(),f.info(o+": restart"))),void 0===p[o]){let t=f.selele(a);if(null!==t){let e=document.createElement("span");for(var d in e.classList.add("tfgsFoldbuttonButton"),l)e.style[d]=l[d];e.innerText=i,e.checked=!1,e.addEventListener("click",function(){e.checked?(void 0!==s&&document.body.classList.remove(s),"function"==typeof u&&u(),e.innerText=i):(void 0!==s&&document.body.classList.add(s),"function"==typeof c&&c(),e.innerText=r),e.checked^=!0,dispatchEvent(new Event("resize"))}),t.appendChild(e),n.clickaftercreate&&e.click(),p[o]=e,f.info(o+": OK")}}}else void 0!==p[o]&&(p[o].remove(),(p[o]=void 0)!==s&&document.body.classList.remove(s),"function"==typeof u&&u(),dispatchEvent(new Event("resize")),f.info(o+": OFF"))}function v(){try{function e(){let e=p.fullscreen;null===document.fullscreenElement!=("✠"===e.innerText)&&e.click()}var t;if(n.expand100?document.body.classList.contains("tfgsFoldbuttonExpand100")||(document.body.classList.add("tfgsFoldbuttonExpand100"),dispatchEvent(new Event("resize"))):document.body.classList.contains("tfgsFoldbuttonExpand100")&&(document.body.classList.remove("tfgsFoldbuttonExpand100"),dispatchEvent(new Event("resize"))),n.foldmenu?""===document.body.style.getPropertyValue("--tfgsFoldbuttonMenubarHeight")&&document.body.style.setProperty("--tfgsFoldbuttonMenubarHeight",window.getComputedStyle(f.selele("gui_menu-bar-position_")).height):""!==document.body.style.getPropertyValue("--tfgsFoldbuttonMenubarHeight")&&document.body.style.removeProperty("--tfgsFoldbuttonMenubarHeight"),g({buttonid:"foldmenubar",enable:n.foldmenu,styles:{left:0,top:"100%",position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"gui_menu-bar-position_",cssname:"tfgsFoldbuttonMenubarFold",clickaftercreate:!0}),g({buttonid:"fullscreen",enable:n.fullscreen,styles:{right:"calc(2em + 1px)",top:"0.3em",position:"absolute"},addinner:"✠",removeinner:"×",targetcss:"gui_editor-wrapper_",cssname:"tfgsFoldbuttonFullscreen",onadd:function(e){null===document.fullscreenElement&&document.body.requestFullscreen().catch(f.onerror)},onremove:function(e){null!==document.fullscreenElement&&document.exitFullscreen().catch(f.onerror)}}),n.fullscreen!==o&&(n.fullscreen?document.addEventListener("fullscreenchange",e):document.removeEventListener("fullscreenchange",e),o=n.fullscreen),g({buttonid:"foldstagetarget",enable:n.foldstagetarget,styles:{right:0,top:"0.3em",position:"absolute"},addinner:"▶",removeinner:"◀",targetcss:"gui_editor-wrapper_",cssname:"tfgsFoldbuttonStagetargetFold"}),g({buttonid:"foldblocktool",enable:n.foldblocktool,styles:{left:"calc(60px + 0.5em)",top:"0.5em",position:"absolute",zIndex:2e3},addinner:"◀",removeinner:"▶",targetcss:"injectionDiv",cssname:"tfgsFoldbuttonBlocktoolFold"}),g({buttonid:"foldspriteinfo",enable:n.foldspriteinfo,styles:{left:0,top:0,position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsFoldbuttonSpriteinfoFold"}),g({buttonid:"foldstagebutton",enable:n.foldstagebutton,styles:{right:0,top:"calc(2em + 1px)",position:"absolute"},addinner:"▶",removeinner:"◀",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsFoldbuttonStagebuttonFold"}),g({buttonid:"foldthestage",enable:n.foldthestage,styles:{right:0,top:0,position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsFoldbuttonStageFold"}),g({buttonid:"foldassetpanel",enable:n.foldassetpanel,styles:{right:0,top:0,position:"absolute"},addinner:"▶",removeinner:"◀",onadd:function(){let e=f.selele("selector_list-area_1Xbj_");var t=f.selele("sprite-selector-item_is-selected_",e);e.scrollTo(0,t.parentElement.offsetTop-e.offsetHeight/2+t.parentElement.offsetHeight/2)},onremove:function(){let e=f.selele("selector_list-area_1Xbj_");var t=f.selele("sprite-selector-item_is-selected_",e);e.scrollTo(0,t.parentElement.offsetTop-e.offsetHeight/2+t.parentElement.offsetHeight/2)},targetcss:"selector_wrapper_",cssname:"tfgsFoldbuttonAssetpanelFold"}),n.autoscrollassetpanel){let e=f.selele("selector_list-area_1Xbj_");null===e||b()===i&&y()===_oldEditingId||(t=f.selele("sprite-selector-item_is-selected_",e),e.scrollTo(0,t.parentElement.offsetTop-e.offsetHeight/2+t.parentElement.offsetHeight/2),i=b(),_oldEditingId=y())}}catch(e){f.error(e)}}function b(){return f.store().getState().scratchGui.editorTab.activeTabIndex}function y(){return f.store().getState().scratchGui.targets.editingTarget}E.func.add({id:"foldbutton",name:"折叠展开按钮",info:"添加可以折叠舞台、角色，展开列表等区域的按钮",option:{foldmenu:{type:"check",name:"折叠菜单",default:!0},fullscreen:{type:"check",name:"全屏按钮",default:!0},foldblocktool:{type:"check",name:"折叠积木盒",default:!0},foldblocktoolauto:{type:"check",name:"点击类别时展开(五)",default:!0},foldstagetarget:{type:"check",name:"折叠舞台和角色列表",default:!0},foldspriteinfo:{type:"check",name:"折叠角色参数",default:!0},foldstagebutton:{type:"check",name:"折叠舞台按钮",default:!0},foldthestage:{type:"check",name:"折叠舞台",default:!0},foldassetpanel:{type:"check",name:"展开素材列表",default:!0},autoscrollassetpanel:{type:"check",name:"自动滚动到当前造型",default:!0},expand100:{type:"check",name:"填满屏幕(可能开了反而出问题)",default:!1}},onenable:function(e){f=e,n=f.getoption(),-1===t&&(t=setInterval(v,200))},ondisable:function(){-1!==t&&(clearInterval(t),n={},v(),t=-1)},onoption:function(){n=f.getoption()}})}{let l,a=null,o=[],i=[],n=[],e=-1,s=null,u={};function w(e,t){if(null!==e){for(;t!==e&&null!==t;)t=t.parentElement;return t===e}}function x(t,e,n){let o=E.element.create("div",l.selcss("react-contextmenu-item")+" "+l.selcss("context-menu_menu-item_"));return o.innerText=e,o.onclick=function(e){return t.style.opacity=0,t.style.pointerEvents="none",n(e),e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)},o.onmousedown=function(e){return e.stopPropagation(),!(e.cancelBubble=!0)},t.appendChild(o),o}function k(){-1===e&&(e=setInterval(k,500)),null===a&&(a=l.vm()),s=l.selele("selector_list-area_");var t=l.selall("sprite-selector-item_sprite-selector-item_");for(let e=0;e<o.length;e++)w(document.body,o[e])||(o[e].remove(),o.splice(e,1),e--);for(let e=0;e<i.length;e++)w(document.body,i[e])||(i.splice(e,1),e--);for(let e=0;e<n.length;e++)w(document.body,n[e])||(n.splice(e,1),e--);for(let e=0;e<t.length;e++){let n=l.selele("react-contextmenu",t[e]);null===n?(l.warn("no menu found"),l.warn(t[e])):(i.includes(n)||(u.rename&&o.push(x(n,"重命名",function(){let e=w(s,n)?2:1;setTimeout(function(){n.parentElement.children[e].children[0].click()},10)})),l.RESPECTnodownload_DO_NOT_DELETE()||(w(s,n)?u.copymd5&&o.push(x(n,"复制 md5ext",function(){var e=1===l.currenttab()?"costumes":"sounds",t=n.parentElement,t=Number(t.children[0].innerText)-1,e=a.runtime.getEditingTarget().sprite[e][t];l.copy(e.assetId+"."+e.dataFormat)})):u.download&&o.push(x(n,"导出全部素材",function(){let e=a.runtime.targets,c=null,t=n.parentElement.children[1].children[0].innerText;if(e.forEach(e=>{e.isOriginal&&e.sprite.name===t&&(c=e.sprite)}),null===c)l.error(`Sprite \`${val}' not found.`);else try{let l=["con","prn","aux","nul","com1","com2","com3","com4","com5","com6","com7","com8","com9","lpt1","lpt2","lpt3","lpt4","lpt5","lpt6","lpt7","lpt8","lpt9"],i=[],r="",a=(c.costumes.forEach((e,t)=>{var n="造型 "+(t+1)+"\n角色: "+c.name+"\n造型: "+e.name+"\nmd5ext: "+e.assetId+"."+e.asset.dataFormat;let o;switch(u.downloadname){case"1":o=String(t+1),u.downloadnum&&(o=o.padStart("0",String(c.costumes.length).length));break;case"1a":o=String(t+1),u.downloadnum&&(o=o.padStart("0",String(c.costumes.length).length)),o+=" "+e.name;break;case"a":o=e.name}i.push({folder:"costumes/",name:o,ext:"."+e.asset.dataFormat,data:e.asset.data}),r+=n+"\n\n"}),c.sounds.forEach((e,t)=>{var n="声音 "+(t+1)+"\n角色: "+c.name+"\n声音: "+e.name+"\nmd5ext: "+e.assetId+"."+e.asset.dataFormat;let o;switch(u.downloadname){case"1":o=String(t+1),u.downloadnum&&(o=o.padStart("0",String(c.costumes.length).length));break;case"1a":o=String(t+1),u.downloadnum&&(o=o.padStart("0",String(c.costumes.length).length)),o+=" "+e.name;break;case"a":o=e.name}i.push({folder:"sounds/",name:o,ext:"."+e.asset.dataFormat,data:e.asset.data}),r+=n+"\n\n"}),E.storezip.create()),s=(a.begin(),[]);i.forEach(e=>{var t=e.folder;let n;switch(u.downloadesc){case"no":n=e.name.replace(RegExp('[*.?:/\\<|>\n\r\t"ÿ-￿]',"g"),"");break;case"_":n=e.name.replace(RegExp('[*.?:/\\<|>\n\r\t"ÿ-￿]',"g"),"_")}let o=n;var i=e.ext;let r=(t+o+i).toLowerCase();if(l.includes(o)||s.includes(r))for(let e=1;e<1e4&&(o=n+"("+e+")",r=(t+o+"."+i).toLowerCase(),l.includes(o)||s.includes(r));e++);s.push(r),a.addfile(t+o+i,e.data,e.comment)}),a.addfile("filelist.txt",r);var o=a.end(r);let n=new FileReader;n.onload=function(){let e=E.element.create("a");var t=c.name.replace(RegExp('[*.?:/\\<|>\n\r\t"]',"g"),"_");e.download=t+".zip",e.href=n.result,e.click()},o=new Uint8Array(o),n.readAsDataURL(new Blob([o],{type:"application/zip"}))}catch(e){l.onerror(e)}})))),i.push(n))}l.selall("sprite-selector-item_sprite-selector-item_").forEach(t=>{if(!n.includes(t)){n.push(t);let e;e=(w(s,t)?t.children[2]:t.children[1]).children[0],console.log(e),u.rename&&(e.classList.add("tfgsResourcesRenamable"),e.addEventListener("click",I))}})}function I(e){let n=this,o=n.parentElement.parentElement,i=n.innerText,r=E.element.create("input","tfgsResourcesRename");return n.innerHTML="",n.appendChild(r),r.value=i,r.onblur=function(){if(w(s,o)){var e=1===l.currenttab()?"renameCostume":"renameSound",t=Number(o.children[0].innerText)-1;r.value!==i&&a[e](t,r.value),n.innerText=i}else{let e=a.runtime.targets,t=null;e.forEach(e=>{e.isOriginal&&e.sprite.name===i&&(t=e.id)}),null===t?l.error(`Sprite \`${i}' not found.`):(l.log(t),r.value!==i&&a.renameSprite(t,r.value),n.innerText=i)}},r.ontouchstart=function(e){e.stopPropagation(),e.cancelBubble=!0},r.onkeydown=function(e){13===e.code&&(r.blur(),e.preventDefault())},r.onmousedown=function(e){e.stopPropagation(),e.cancelBubble=!0},r.onclick=function(e){e.stopPropagation(),e.cancelBubble=!0},r.oncontextmenu=function(e){e.stopPropagation(),e.cancelBubble=!0},r.focus(),e.preventDefault(),e.stopPropagation(),!(e.cancelBubble=!0)}function t(){for(-1!==e&&(clearInterval(e),e=-1);0!==o.length;)o[0].remove(),o.splice(0,1);for(i=[];0!==n.length;){let e=n.splice(0,1)[0].children[2].children[0];e.classList.remove("tfgsResourcesRenamable"),e.removeEventListener("click",I)}}E.func.add({id:"spritemenu",name:"角色与素材右键菜单",info:"重命名、复制md5、导出所有造型和声音",option:{rename:{type:"check",name:"点击/右键重命名",default:!0},download:{type:"check",name:"下载全部素材",default:!0},downloadname:{type:"menu",name:"素材命名方式",menu:["数字","名字","数字+名字"],value:["1","a","1a"],default:"1a"},downloadnum:{type:"check",name:"数字前补0",default:!0},downloadesc:{type:"menu",name:"特殊字符与中文处理(由于编码原因中文乱码)",menu:["删除","替换为_"],value:["no","_"],default:"_"},copymd5:{type:"check",name:"复制素材md5",default:!0}},onenable:function(e){l=e,u=l.getoption(),k()},ondisable:function(){t()},onoption:function(){u=l.getoption(),t(),k()}})}{let t=-1,e=null,o=null,n=null,i=null,r=null,l=null,a=!1,s=!1,c={},u=!1,d=!1,f=!1,p="",h=0,m=0,g=document.body,v="";function D(){try{null===l&&(e=api.blockly(),o=api.workspace(),n=o.getCanvas().parentElement,i=api.toolbox(),r=i.getCanvas().parentElement,l=e.Events.fire,e.Events.fire=function(e){try{if(s&&"click"===e.element&&(v=e.blockId),!s||"stackclick"!==e.element||d&&c.ctrlRun)return l.apply(this,arguments);var t,n;c.rightMenu&&("touch"===p?(t={type:"touchstart",button:2,changedTouches:[{identifier:-1,clientX:h,clientY:m,target:g}],clientX:h,clientY:m,preventDefault:function(){},stopPropagation:function(){},target:g},o.getBlockById(v).showContextMenu_(t)):(n={type:"mousedown",button:2,clientX:h,clientY:m,view:window,target:g},o.getBlockById(v).showContextMenu_(n)))}catch(e){return api.onerror(e),l.apply(this,arguments)}}),s=!0,window.addEventListener("keydown",R),window.addEventListener("keyup",R),n.addEventListener("mousedown",B),n.addEventListener("touchstart",W),r.addEventListener("mousedown",B,!0),r.addEventListener("touchstart",W,!0),window.addEventListener("blur",J)}catch(e){api.onerror(e),t=setTimeout(D,500)}}function R(e){f!==e.altKey&&c.altMove&&(e.altKey?(a=o.options.readOnly,o.options.readOnly=!0):o.options.readOnly=a),u=e.shiftKey,d=e.ctrlKey,f=e.altKey}function B(e){p="mouse",h=e.clientX,m=e.clientY,g=e.target}function W(e){p="touch",0!==e.touches.length&&(h=e.touches[0].clientX,m=e.touches[0].clientY,g=e.target)}function J(e){R({altKey:!1,ctrlKey:!1,shiftKey:!1}),B({clientX:0,clientY:0,target:document.body})}E.func.add({id:"lockrun",name:"禁止点击时运行积木",info:"点击积木时积木将不会运行",option:{rightMenu:{type:"check",name:"不仅不运行，还显示右键菜单",default:!1},ctrlRun:{type:"check",name:"按住ctrl点击可以运行",default:!0},altMove:{type:"check",name:"按住alt拖动视角(防止拖动视角时拖动积木)",default:!0}},onenable:function(e){api=e,c=api.getoption(),D()},ondisable:function(){-1!==t&&(clearTimeout(t),t=-1),s=!1,window.removeEventListener("keydown",R),window.removeEventListener("keyup",R),n.removeEventListener("mousedown",B),n.removeEventListener("touchstart",W),r.removeEventListener("mousedown",B,!0),r.removeEventListener("touchstart",W,!0),window.removeEventListener("blur",J)},onoption:function(){c=api.getoption()}})}{let e=document.createElement("style");e.innerHTML='.tfgsWindow.tfgsEmergency{--tfgsWindowColor:#f80}.tfgsWindow{--tfgsWindowColor:#08f;box-shadow:0 0 2px #000;position:fixed;background:#fff;border:3px solid var(--tfgsWindowColor);border-radius:3px;overflow:hidden;box-sizing:border-box}.tfgsWindow *{box-sizing:content-box}.tfgsWindowTitle{background:var(--tfgsWindowColor);display:flex;display:-webkit-flex;flex-flow:row nowrap;align-items:center;border-bottom:3px solid var(--tfgsWindowColor);color:#fff;font-family:sans-serif;font-size:16px;line-height:20px;height:20px}.tfgsWindowTitle>span{width:20px;height:20px;text-align:center;flex:none;user-select:none;-moz-user-select:none}.tfgsWindowTitle>span:active{background:rgba(0,0,0,.25);box-shadow:1px 1px 2px rgba(0,0,0,.3) inset}.tfgsWindowTitle>.tfgsWindowText{width:fit-content;flex:auto;overflow:hidden;white-space:pre;text-overflow:ellipsis;text-overflow:"...";position:relative}.tfgsWindowTitle>.tfgsWindowText:active{background:0 0;box-shadow:none}.tfgsWindowContent{height:calc(100% - 20px - 2px);overflow:auto;position:relative;font-size:16px;font-family:monospace;color:#000}.tfgsWindowResize{position:absolute;right:0;bottom:0;width:0;height:0;border-left:15px solid transparent;border-bottom:15px solid var(--tfgsWindowColor);cursor:se-resize}.tfgsWindowResize:after{content:"=";position:absolute;left:-8px;top:0;transform:rotate(-45deg);color:#fff}.tfgsMenuContent{height:calc(100% - 30px);background:#f0f8ff;overflow:auto;text-align:center}.tfgsMenuButtons{height:30px;background:var(--tfgsWindowColor)}.tfgsMenuFunc{margin:5px;border-radius:2px;box-shadow:0 0 2px rgba(0,0,0,.5);overflow:hidden;text-align:left}.tfgsMenuFuncOption{background:#def;padding:2px;max-height:200px;box-sizing:border-box;overflow:auto;transition:.2s}.tfgsMenuFuncOption.tfgsMenuFuncFold{max-height:0}.tfgsMenuFuncOptionOne{display:inline-block;margin:2px;padding:2px;background:#bdf;box-shadow:0 0 2px rgba(0,0,0,.5);border-radius:2px;box-sizing:border-box;width:calc(50% - 6px);font-size:12px}.tfgsMenuFunc input,.tfgsMenuFunc select{position:relative;vertical-align:middle;border:none;background:#fff;width:80px;margin:1px;padding:1px;box-shadow:0 0 2px rgba(0,0,0,.5);border-radius:2px;font-size:12px}.tfgsMenuFuncOptionOne>input{box-shadow:0 0 2px rgba(0,0,0,.5) inset}.tfgsMenuFuncOptionOne>input[type=checkbox],.tfgsMenuFuncTitle>input{width:15px;height:15px;box-shadow:0 0 2px rgba(0,0,0,.5)}.tfgsMenuFunc input:active,.tfgsMenuFunc select:active{background:#9cf}.tfgsMenuFunc input:focus,.tfgsMenuFunc select:focus{background:#def;outline:0}.tfgsMenuFuncTitle{background:#08f;color:#fff;padding:2px;font-weight:700;font-family:monospace}.tfgsMenuFuncInfo{font-size:12px}.tfgsMenuFuncName{font-size:15px}.tfgsLogFormat{display:block;white-space:pre-wrap;word-break:break-all;font-family:monospace;font-size:15;overflow:scroll}.tfgsLogFormat>:nth-child(odd){background:#f0f8ff}.tfgsLogFormat>:nth-child(2n){background:#def}.tfgsLogContent{height:calc(100% - 30px);background:#fff}.tfgsLogButtons{height:30px;background:var(--tfgsWindowColor)}.tfgsButton{display:inline-block;min-width:40px;height:25px;line-height:25px;text-align:center;font-size:16px;color:#000;margin:2px;background:#fff;user-select:none;border-radius:2px;box-shadow:0 0 2px rgba(0,0,0,.5)}.tfgsButton:active{background:#9cf}.tfgsDisable{display:none}.tfgsRight{float:right}span.tfgsFoldbuttonButton{position:absolute;color:grey;background:#fff;font-size:1em;line-height:30px;width:30px;height:30px;border-radius:2px;border:1px solid grey;text-align:center;cursor:pointer}body.tfgsFoldbuttonMenubarFold div[class*=gui_menu-bar-position_]{top:calc(0px - var(--tfgsFoldbuttonMenubarHeight));margin-bottom:calc(0px - var(--tfgsFoldbuttonMenubarHeight))}body.tfgsFoldbuttonMenubarFold div[class*=gui_body-wrapper_]{height:100%}body.tfgsFoldbuttonBlocktoolFold .blocklyFlyout,body.tfgsFoldbuttonBlocktoolFold .blocklyFlyoutScrollbar{left:-250px}body.tfgsFoldbuttonStagetargetFold div[class*=gui_stage-and-target-wrapper_]{display:none}body.tfgsFoldbuttonSpriteinfoFold div[class*=sprite-info_sprite-info_],body.tfgsFoldbuttonSpriteinfoFold div[class*=target-pane_target-preview_]{max-height:0;padding:0;overflow:hidden}body.tfgsFoldbuttonStagebuttonFold div[class*=target-pane_stage-selector-wrapper_]{max-width:0;padding:0;margin-left:0;margin-right:0;overflow:hidden}body.tfgsFoldbuttonStageFold div[class*=stage-wrapper_stage-canvas-wrapper_]{max-height:0;padding:0;overflow:hidden}body.tfgsFoldbuttonFullscreen{overflow:scroll}body.tfgsFoldbuttonExpand100{position:fixed;bottom:0}body.tfgsFoldbuttonAssetpanelFold [class*=selector_wrapper_]{position:absolute;height:100%;width:100%;z-index:2}body.tfgsFoldbuttonAssetpanelFold [class*=selector_list-area_]{flex-direction:row;flex-wrap:wrap;align-content:flex-start}body.tfgsFoldbuttonAssetpanelFold [class*=sprite-selector-item_sprite-selector-item_]{margin-left:.8em}body.tfgsFoldbuttonAssetpanelFold [class*=asset-panel_detail-area_]{padding-left:45px}div.tfgsResourcesRenamable{border-bottom:1px dotted #565e75;min-height:1em}[class*=sprite-selector-item_is-selected] div.tfgsResourcesRenamable{border-bottom:1px dotted #fff}input.tfgsResourcesRename{border:2px solid #565e75;width:100%;height:100%;background:inherit;color:inherit;box-sizing:border-box;text-align:inherit;margin:inherit;padding:inherit;font-family:inherit;font-size:inherit;line-height:inherit;outline:0}[class*=sprite-selector-item_is-selected] input.tfgsResourcesRename{border:2px solid #fff}.tfgsCCWtermSpan{position:absolute;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.tfgsCCWtermSpan>span{display:inline-block;width:calc(var(--termWidth) * var(--scale));height:calc(var(--termHeight) * var(--scale));overflow:hidden}.tfgsCCWtermSpan>span>div#terminal-container{background:#000;transform:scale(var(--scale));transform-origin:-10px -10px}.tfgsJoystick{display:flex;padding:2px;height:calc(100% - 4px)}.tfgsJoystickKeyBoard{width:calc(100% - 4px);flex-flow:column nowrap;border:1px solid #000;font-size:20px;padding:1px}.tfgsJoystickKeyBoard>span{display:flex;flex:1 1 0;flex-flow:row nowrap;overflow:hidden}.tfgsJoystickKeyBoard>span>span{flex:1 1 0;margin:1px;border:1px solid #000;font-size:20px;box-sizing:border-box;white-space:pre;overflow:hidden;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.tfgsJoystickMouse{width:calc(100% - 4px);flex-flow:column nowrap;border:1px solid #000;font-size:20px;padding:1px}.tfgsJoystickMouse>.tfgsJoystickMouseMove{flex:4 4 0;border:1px solid #000;margin:1px;padding:1px}.tfgsJoystickMouse>span{flex:1 1 0;display:flex;flex-flow:row nowrap}.tfgsJoystickMouseClick,.tfgsJoystickMouseSwitch{flex:1 1 0;border:1px solid #000;margin:1px;padding:1px}.tfgsJoystickCursor{position:fixed;z-index:1000000000;text-shadow:0 0 2px #fff;color:grey;pointer-events:none;font-size:30px}.tfgsJoystickGamepad{display:flex;flex-flow:row nowrap;width:calc(100% - 4px)}.tfgsJoystickGamepad>span{border:1px solid #000;flex:1 1 0;overflow:hidden}.tfgsJoystickJoystick{display:flex;width:100%;height:100%;align-items:center;justify-content:center}.tfgsJoystickJoystick>span{display:flex;position:relative;width:var(--size);height:var(--size);border:1px solid #000;border-radius:1000px;align-items:center;justify-content:center}.tfgsJoystickJoystick>span>span{position:relative;width:50%;height:50%;border:1px solid #000;border-radius:1000px}.tfgsJoystickJoystickKeyBoard{display:flex;height:calc(100% - 4px);flex-flow:column nowrap;border:1px solid #000;font-size:20px;padding:1px}.tfgsJoystickJoystickKeyBoard>span{display:flex;flex:1 1 0;flex-flow:row nowrap;overflow:hidden}.tfgsJoystickJoystickKeyBoard>span>span{flex:1 1 0;margin:5px;text-align:center;border:1px solid #000;font-size:20px;box-sizing:border-box;white-space:pre;overflow:hidden;border-radius:1000px;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.tfgsJoystickJoystickMouse{display:inline-block;height:100%;width:100%}.tfgsJoystickSwitch{position:absolute;right:2px;bottom:2px;height:10%;width:10%}.tfgsForcecolorWin{font-size:16px;text-align:center}.tfgsForcecolorWin input{width:150px;border:1px solid #000}.tfgsForcecolorWin pre{font-size:8px}',document.head.appendChild(e)}E.data.load().then(E.menu.create).catch(E.error)}catch(e){throw alert(e.message),console.error(e),e}function A(e,t){e.style.display=t?"inherit":"none"}function H(){return"targetTouches"in event?{x:Math.round(event.targetTouches[0].clientX),y:Math.round(event.targetTouches[0].clientY)}:{x:Math.round(event.clientX),y:Math.round(event.clientY)}}}();