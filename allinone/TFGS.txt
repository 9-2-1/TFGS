avascript:let h={};try{if("__TFGS$O{{iQq\\\\}{"in window)throw new Error("TFGS 已经安装");function u(){return"targetTouches"in event?{x:Math.round(event.targetTouches[0].clientX),y:Math.round(event.targetTouches[0].clientY)}:{x:Math.round(event.clientX),y:Math.round(event.clientY)}}function o(e){return"string"==typeof e}function r(e,t,n){let i=document.createElement(e);return o(t)&&(i.className=t),o(n)&&(i.type=n),i}function d(e,t){e.style.display=t?"inherit":"none"}window["__TFGS$O{{iQq\\\\}{"]="tfgs_installed",h.button={},h.button.create=function(){h.menu.create()},h.data={},h.data.list={},h.data.getjson=function(){return JSON.stringify(h.data.list)},h.data.setjson=function(e){var t,n=JSON.parse(e);let i={};for(t in h.func.list){let e={};for(var o in h.func.list[t].option)e[o]="any";i[t]={enable:"boolean?",data:"any",option:e},h.data.list=function t(n,i){if("object"==typeof i){let e=Array.isArray(i)?[]:{};for(var o in i)e[o]=t(null==n?void 0:n[o],i[o]);return e}switch(i){case"string":case"":return String(n);case"string!":case"!":return"string"==typeof n?n:"";case"string?":case"?":return"string"==typeof n?n:void 0;case"number":case"0":return Number(n);case"number!":case"0!":return"number"==typeof n?n:0;case"number?":case"0?":return"number"==typeof n?n:void 0;case"boolean":return Boolean(n);case"boolean!":case"false!":return"boolean"==typeof n&&n;case"boolean?":case"false?":return"boolean"==typeof n?n:void 0;case"array":case"[]":{let e=[];for(var s in n)e[s]=n[s];return e}case"array!":case"[]!":return Array.isArray(n)?n:[];case"array?":case"[]?":return Array.isArray(n)?n:void 0;case"object":case"{}":{let e={};for(var a in n)e[a]=n[a];return e}case"object!":case"{}!":return Object.isObject(n)?n:{};case"object?":case"{}?":return Object.isObject(n)?n:void 0;case"any":return n}}(n,i)}h.func.datachange()},h.data.load=function(){return new Promise(function(e,t){let n=null,i=null;function o(){null===n&&"localStorage"in window&&(n=localStorage.getItem("-tfgs-")),e(n)}"chrome"in window&&"storage"in chrome?i=chrome.storage:"browser"in window&&"storage"in browser&&(i=browser.storage),null!==i?i.sync.getItem("-tfgs-",function(e){n=e["-tfgs-"],o()}):o()}).then(h.data.setjson)},h.data.save=function(){return new Promise(function(e,t){let n=null;function i(){"localStorage"in window&&localStorage.setItem("-tfgs-",h.data.getjson()),e()}"chrome"in window&&"storage"in chrome?n=chrome.storage:"browser"in window&&"storage"in browser&&(n=browser.storage),null!==n?n.sync.setItem({"-tfgs-":h.data.getjson()},function(e){i()}):i()})},h.data.import=function(){return new Promise(function(n,e){let i=document.createElement("input");i.type="file",i.addEventListener("change",function(e){if(0<i.files.length){let t=new FileReader;t.addEventListener("load",function(e){n(t.result.toString())}),t.readAsBinaryString(i.files[0])}}),i.click()}).then(h.data.setjson).then(h.data.save).then(h.menu.load)},h.data.export=function(){let i=h.data.getjson();return new Promise(function(e,t){let n=document.createElement("a");n.href="data:text/plain;charset:utf-8,"+i,n.download="tfgs-options.json",n.click(),e()})},h.data.edit=function(){return h.funcapi.prompt("-tfgs-","编辑配置文本",h.data.getjson()).then(function(e){null!==e&&h.data.setjson(e)})},h.drag={},h.drag.setdrag=function(i,o){function e(e){var t,n=o.onStart(e);if(null!==n)return t=u(),l=t,s=t.x-n.x,a=t.y-n.y,r="click",window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),window.addEventListener("mouseleave",d),window.addEventListener("blur",d),i.addEventListener("touchmove",c),i.addEventListener("touchend",d),e.preventDefault(),!(e.cancelBubble=!0)}let s,a,r,l,c=function(e){var t=u();l.x===t.x&&l.y===t.y||(o.onMove(t.x-s,t.y-a,e),l=t,r="drag")},d=function(e){o.onEnd(r,e),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),window.removeEventListener("mouseleave",d),window.removeEventListener("blur",d),i.removeEventListener("touchmove",c),i.removeEventListener("touchend",d)};return i.addEventListener("mousedown",e),i.addEventListener("touchstart",e),function(){i.removeEventListener("mousedown",e),i.removeEventListener("touchstart",e)}},h.error=function(e){throw alert(e.message),console.error(e),e},h.func={},h.func.list={},h.func.add=function(e){if(e.id in h.func.list)throw new Error("id used: "+e.id);h.func.list[e.id]={name:e.name,info:e.info,default:e.default,option:e.option,onenable:e.onenable,ondisable:e.ondisable,onoption:e.onoption,enable:!1}},h.func.default=function(t){let n={};var i,o=h.func.list;for(i in o){var s,a=o[i].option;let e={};for(s in a)e[s]=a[s].default;n[i]={enable:o[i].default,option:e,data:!t&&i in h.data.list?h.data.list[i].data:void 0}}h.data._default(n)},h.func.datachange=function(){for(var t in h.func.fixoption(),h.func.list){let e=h.func.list[t];var n=h.data.list[t].enable;if(e.enable!==n){try{e[n?"onenable":"ondisable"](h.funcapi._getapi(t))}catch(e){h.funcapi.error(t,"Error: "+e.message),console.error(e)}e.enable=n}else if(n)try{e.onoption(h.funcapi._getapi(t))}catch(e){h.funcapi.error(t,"Error: "+e.message),console.error(e)}}},h.func.fixoption=function(){var n,e=h.func.list;for(n in e){"boolean"!=typeof h.data.list[n].enable&&(h.data.list[n].enable=e[n].default);var i,o=e[n].option;for(i in o){let e=o[i],t=h.data.list[n].option;switch(e.type){case"text":null!==t[i]&&void 0!==t[i]||(t[i]=e.default),"string"!=typeof t[i]&&(t[i]=String(t[i])),"maxlength"in e&&t[i].length>e.maxlength&&(t[i]=t[i].slice(0,e.maxlength));break;case"number":"number"!=typeof t[i]&&(t[i]=Number(t[i])),isNaN(t[i])&&(t[i]=e.default),t[i]<e.min&&(t[i]=e.min),t[i]>e.max&&(t[i]=e.max);break;case"check":"boolean"!=typeof t[i]&&(t[i]=e.default);break;case"menu":e.value.includes(t[i])||(t[i]=e.default)}}}},h.funcapi={},h.funcapi.log=function(e,t){console.log(e,t),h.log.add(e,"#000000",t)},h.funcapi.warn=function(e,t){console.warn(e,t),h.log.add(e,"#808000",t)},h.funcapi.onerror=function(e,t){console.error(e,t),h.log.add(e,"#E00000",t.message)},h.funcapi.error=function(e,t){console.error(e,t),h.log.add(e,"#E00000",t)},h.funcapi.info=function(e,t){console.info(e,t),h.log.add(e,"#2020F0",t)},h.funcapi.getoption=function(e){return h.data.list[e].option},h.funcapi.getdata=function(e){return h.data.list[e].data},h.funcapi.setdata=function(e,t){return h.data.list[e].data=t,h.data.save()},h.funcapi.alert=function(e,n){return new Promise(function(e,t){alert(n),e()})},h.funcapi.confirm=function(e,n){return new Promise(function(e,t){e(confirm(n))})},h.funcapi.prompt=function(e,n,i){return new Promise(function(e,t){e(prompt(n,i))})},h.funcapi._getapi=function(n){let t={};for(let e in h.funcapi)t[e]=function(){let t=[n];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);return h.funcapi[e].apply(h.funcapi,t)};return t},h.log={},h.log.list=[],h.log.dispIntv=null,h.log.add=function(e,t,n){for(h.log.list.push({name:e,color:t,log:n});500<h.log.list.length;)h.log.list.splice(0,1);h.log.changed=!0},h.log.clear=function(){h.log.list=[],h.log.changed=!0},h.log.displayInterval=function(n,i){return h.log.display(n,i),h.log.changed=!1,setInterval(function(){var e=n.scrollX,t=n.scrollY;h.log.changed&&(n.innerHTML="",h.log.display(n,i),h.log.logwin.flash(500,3,!0),h.log.changed=!1),n.scrollX=e,n.scrollY=t},100)},h.log.display=function(t,e){for(var n in t.classList.add("tfgsLogFormat"),h.log.list){n=h.log.list[n];if((null===e.name||e.name.includes(n.name))&&(null===e.color||e.color.includes(n.color))){let e=r("div");e.style.color=n.color,e.innerText=n.name+"\t"+n.log,t.appendChild(e)}}},h.log.create=function(i,o){try{if(null!==h.log.dispIntv)return h.log.logwin.movetotop(),void h.log.logwin.flash(200,3,!1);let e=h.log.logwin=h.window.create({title:"日志",x:"number"==typeof i?i:20,y:"number"==typeof o?o:20,width:200,height:200,minWidth:100,minHeight:50,minimizeWidth:70}),t=e.innerDiv;t.innerHTML=`\n<div class="tfgsLogContent"></div>\n<div class="tfgsLogButtons">\n	<span class="tfgsButton tfgsRight">清空</span>\n</div>\n`;var s=t.children[0];let n=t.children[1].children[0];h.log.dispIntv=h.log.displayInterval(s,{name:null,color:null}),n.addEventListener("click",function(){h.log.clear()}),e.onClose=function(){clearInterval(h.log.dispIntv),t.remove(),h.log.dispIntv=null}}catch(e){h.error(e)}},h.menu={},h.menu.menuwin=null,h.menu.modi=!1,window.addEventListener("beforeunload",function(e){if(h.menu.modi)return e.preventDefault(),e.returnValue=""}),h.menu.setmodi=function(n){if(n!==h.menu.modi){let t=h.menu.buttons;for(var i in t){let e=!0;switch(i){case"edit":continue;case"save":case"cancel":e=!1}t[i].classList[n===e?"add":"remove"]("tfgsDisable")}h.menu.menuwin.title=n?"TFGS 选项 (未保存)":"TFGS 选项",h.menu.menuwin.canMinimize=!n,h.menu.menuwin._refresh(),h.menu.modi=n}},h.menu.create=function(){if(null===h.menu.menuwin){function a(e,t,n){let i=document.createElement(e);return void 0!==t&&(i.className=t),i.className=t,void 0!==n&&(i.type=n),i}let e=h.window.create({title:"TFGS选项",canMinimize:!0,canClose:!1,x:50,y:50,width:250,height:250,minWidth:200,minHeight:100,minimizeWidth:100}),t=(e.minimize(),e.innerDiv),n=(t.innerHTML=`\n<div class="tfgsMenuContent">\n	<!--<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>\n	<span class="tfgsMenuFuncSelect">Test</span>-->\n</div>\n<div class="tfgsMenuButtons">\n	<span class="tfgsButton">导出</span>\n	<span class="tfgsButton">导入</span>\n	<span class="tfgsButton tfgsDisable">编辑文本</span>\n	<span class="tfgsButton tfgsRight">显示日志</span>\n	<span class="tfgsButton tfgsRight tfgsDisable">取消更改</span>\n	<span class="tfgsButton tfgsDisable">保存更改</span>\n</div>\n`,h.menu.contentdiv=t.children[0]);var r=h.menu.buttondiv=t.children[1];let i=h.menu.buttons={},o=(i.export=r.children[0],i.import=r.children[1],i.edit=r.children[2],i.log=r.children[3],i.cancel=r.children[4],i.save=r.children[5],i.export.addEventListener("click",function(){h.menu.modi||h.data.export()}),i.import.addEventListener("click",function(){h.menu.modi||h.data.import().catch(h.error)}),i.edit.addEventListener("click",function(){h.menu.modi||h.data.edit().then(h.data.save).then(h.menu.load).catch(h.error)}),i.log.addEventListener("click",function(){h.menu.modi||h.log.create()}),!1);e.onResize=function(){o!==e.isMinimize&&(e.isMinimize?h.menu.modi&&e.restore():h.menu.load(),o=e.isMinimize)},i.save.addEventListener("click",function(){if(h.menu.modi)try{h.menu.save().then(function(){h.menu.load(),h.menu.setmodi(!1)}).catch(h.error)}catch(e){h.error(e)}}),i.cancel.addEventListener("click",function(){if(h.menu.modi&&confirm("取消更改？"))try{h.menu.load(),h.menu.setmodi(!1)}catch(e){alert(e.message)}});var l,c=h.func.list;let s=h.menu.list={};for(l in c){var d=c[l];let e=a("div","tfgsMenuFunc"),i=(e.innerHTML=`\n<div class="tfgsMenuFuncTitle">\n	<input type="checkbox"></input>\n	<span class="tfgsMenuFuncName"></span>\n	<span class="tfgsMenuFuncInfo"></span>\n</div>\n<div class="tfgsMenuFuncOption"></div>\n`,s[l]={});function u(e,t){return null!=e&&""!==e?e+t:""}i.enable=e.children[0].children[0],i.enable.addEventListener("change",function(){h.menu.setmodi(!0)}),i.option={},e.children[0].children[1].innerText=d.name,e.children[0].children[2].innerText=u(d.version," ")+u(d.author," ")+u(d.info,"");let o=e.children[1];var f,m=d.option;for(f in m){var g=m[f];let e,t;switch((e=a("label")).innerText=g.name,g.type){case"number":t=a("input",void 0,"number");break;case"text":t=a("input");break;case"check":t=a("input",void 0,"checkbox");break;case"menu":for(var p in t=a("select"),g.menu){let e=a("option");e.innerText=g.menu[p],e.value=p,t.appendChild(e)}break;default:throw new Error("Unsupport type: "+g.type)}i.option[f]=t;let n=a("span","tfgsMenuFuncOptionOne");n.appendChild(e),n.appendChild(t),o.appendChild(n),t.addEventListener("input",function(){h.menu.setmodi(!0)}),t.addEventListener("paste",function(){h.menu.setmodi(!0)}),t.addEventListener("change",function(){h.menu.setmodi(!0)})}n.appendChild(e)}h.menu.menuwin=e,h.menu.load()}},h.menu.save=function(){return h.data.setjson(h.menu._json()),h.data.save()},h.menu._json=function(){var t,n=h.func.list,i=h.menu.list;let o={};for(t in n){var s=n[t],a=i[t];let e=o[t]={};e.enable=a.enable.checked,e.option={};var r,l=s.option;for(r in l){var c=l[r],d=a.option[r];switch(c.type){case"number":e.option[r]=Number(d.value);break;case"text":e.option[r]=d.value;break;case"check":e.option[r]=d.checked;break;case"menu":e.option[r]=c.value[Number(d.value)];break;default:throw new Error("类型错误: "+c.type)}}}return JSON.stringify(o)},h.menu.load=function(){var e,t=h.func.list,i=h.data.list,o=h.menu.list;for(e in t){var s=t[e],a=i[e];let n=o[e];n.enable.checked=a.enable;var r,l=s.option;for(r in l){let e=l[r],t=n.option[r];var c=a.option[r];switch(e.type){case"number":case"text":t.value=c;break;case"check":t.checked=c;break;case"menu":e.value.includes(c)&&(t.options[e.value.indexOf(c)].selected=!0);break;default:throw new Error("Unsupport type: "+e.type)}}}},h.menu.delete=function(){h.menu.menuwin.canClose=!0,h.menu.menuwin.close(),h.menu.menuwin=null},h.window={},h.window.zIndex=1e6,h.window.create=function(e){let i={titleDiv:null,innerDiv:null,windowDiv:null,resizeDiv:null,x:NaN,y:NaN,width:400,height:300,minHeight:0,minWidth:100,minimizeWidth:100,title:"",haveLogo:!0,canMinimize:!0,canMaximize:!0,canClose:!0,canResize:!0,canMove:!0,onClose:function(){},onResize:function(){},onMove:function(){},isMinimize:!1,isMaximize:!1,posRestore:{},flashMode:!1,flashTimer:-1,_rememberPos:function(){this.isMinimize||this.isMaximize||(this.posRestore.x=this.x,this.posRestore.y=this.y,this.posRestore.width=this.width,this.posRestore.height=this.height)},minimize:function(){this._rememberPos(),this.isMinimize=!0,this.isMaximize=!1,this._refresh(),this.onResize(),this.onMove()},maximize:function(){this._rememberPos(),this.isMinimize=!1,this.isMaximize=!0,this._refresh(),this.onResize(),this.onMove()},restore:function(){this.isMaximize&&(this.x=this.posRestore.x,this.y=this.posRestore.y),this.width=this.posRestore.width,this.height=this.posRestore.height,this.isMinimize=!1,this.isMaximize=!1,this._refresh(),this.onResize(),this.onMove()},movetotop:function(){this.windowDiv.style.zIndex=++h.window.zIndex,this.flashMode&&(this.windowDiv.classList.remove("tfgsEmergency"),this.flashMode=!1),-1!==this.flashTimer&&(clearInterval(this.flashTimer),this.flashTimer=-1)},close:function(){!1!==this.onClose()&&(this.windowDiv.remove(),this.windowDiv=null,window.removeEventListener("resize",t._resizeCallback))},resize:function(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this._refresh(),this.onResize())},move:function(e,t){e===this.x&&t===this.y||(this.x=e,this.y=t,this._refresh(),this.onMove())},flash:function(e,t,n){-1!==this.flashTimer&&clearInterval(this.flashTimer),this.windowDiv.classList.add("tfgsEmergency");let i=!0,o=this;this.flashTimer=setInterval(function(){0<t?i?(o.windowDiv.classList.remove("tfgsEmergency"),i=!1,t--):(o.windowDiv.classList.add("tfgsEmergency"),i=!0):(n&&(o.windowDiv.classList.add("tfgsEmergency"),i=!0),clearInterval(o.flashTimer),o.flashTimer=-1),o.flashMode=i},e)},_refresh:function(){var a=window.innerWidth,r=window.innerHeight;if(this.isMaximize)this.x=0,this.y=0,this.width=a,this.height=r;else{let e=this.minWidth+6,t=this.minHeight+26,n=this.x,i=this.y,o=this.width,s=this.height;this.isMinimize?(o=this.minimizeWidth+6,s=26):(o<e&&(o=e),s<t&&(s=t),o>a&&(o=a),s>r&&(s=r));var l=n+o,c=i+s;isNaN(n)&&(n=Math.floor(Math.random()*(a-o))),isNaN(i)&&(i=Math.floor(Math.random()*(r-s))),n<0&&(n=0),i<0&&(i=0),a<l&&(n-=l-a),r<c&&(i-=c-r),this.x=n,this.y=i,this.width=o,this.height=s}let e=this.windowDiv.style;e.left=this.x+"px",e.top=this.y+"px",e.width=this.width+"px",e.height=this.height+"px",d(this.titleDiv.children[0],!this.isMinimize&&this.haveLogo),this.titleDiv.children[1].innerText=this.title,d(this.titleDiv.children[2],!this.isMinimize&&this.canMinimize),d(this.titleDiv.children[3],this.isMaximize),d(this.titleDiv.children[4],!this.isMinimize&&!this.isMaximize&&this.canMaximize),d(this.titleDiv.children[5],this.canClose),d(this.innerDiv,!this.isMinimize),d(this.resizeDiv,!this.isMinimize&&!this.isMaximize&&this.canResize)}},t=(i=Object.assign(i,e),r("div","tfgsWindow"));t.innerHTML=`\n<div class="tfgsWindowTitle">\n	<span>≡</span>\n	<span class="tfgsWindowText"></span>\n	<span>_</span>\n	<span>▭</span>\n	<span>□</span>\n	<span>✕</span>\n</div>\n<div class="tfgsWindowContent"></div>\n<div class="tfgsWindowResize"></div>\n`,document.body.appendChild(t),t.style.zIndex=++h.window.zIndex,t._resizeCallback=function(){i._refresh(),i.onResize()},window.addEventListener("resize",t._resizeCallback);var e=t.children[0],n=t.children[1],o=t.children[2];let s=e.children;t.addEventListener("mousedown",function(e){i.movetotop()},!0),s[2].addEventListener("click",function(e){i.minimize()}),s[3].addEventListener("click",function(e){i.restore()}),s[4].addEventListener("click",function(e){i.maximize()}),s[5].addEventListener("click",function(e){i.close()});var a={onStart:function(e){return i.isMaximize?null:(i.movetotop(),{x:i.x,y:i.y})},onMove:function(e,t,n){i.canMove&&i.move(e,t)},onEnd:function(e,t){"click"===e&&i.isMinimize&&i.restore()}};return h.drag.setdrag(s[0],a),h.drag.setdrag(s[1],a),h.drag.setdrag(o,{onStart:function(e){return{x:i.width,y:i.height}},onMove:function(e,t,n){i.resize(e,t)},onEnd:function(e,t){}}),i.windowDiv=t,i.titleDiv=e,i.innerDiv=n,i.resizeDiv=o,i._refresh(),i.flash(300,1,!1),i};{let a,r,i,o,s=-1,l=-1,c=0;const y=1200;function f(e){2===e.button&&g(e.clientX,e.clientY)}function m(e){0!==e.touches.length&&g((e=e.touches[0]).clientX,e.clientY)}function g(t,e){t=document.elementFromPoint(t,e);let i,o;if(null!==t){let e=function(e){for(;null!==e&&"svg"!==e.tagName.toLowerCase();)e=e.parentElement;return e}(t);null!==e&&(i=e.classList.contains("blocklyFlyout"),o=function(e){for(;null!==e&&"svg"!==e.tagName.toLowerCase();){if("g"===e.tagName.toLowerCase()){var t=e.getAttribute("data-id");if(null!==t)return t}e=e.parentElement}return null}(t),-1!==l&&(clearInterval(l),l=-1),c=0,l=setInterval(function(){var e,t,n=document.getElementsByClassName("blocklyContextMenu");0!==n.length?(clearInterval(l),l=-1,i,e=o,t=n[0],null!==e?(p("复制这个积木",function(){v(e,!1,!0),t.remove()},t),p("复制这组积木",function(){v(e,!0,!1),t.remove()},t)):(p("复制全部积木",function(){v(null,!0,!1),t.remove()},t),p("粘贴积木文本",function(){navigator.clipboard.readText().then(function(e){var e=Blockly.Xml.textToDom(e),n=Blockly.Xml.domToWorkspace(e,r);if(0===n.length)throw new Error("粘贴失败");var i,e=r.getMetrics(),o=e.viewLeft+15;let s=e.viewTop+15;for(let t=0;t<n.length;t++){let e=r.getBlockById(n[t]);null===e.getParent()&&(i=e.getRelativeToSurfaceXY(),e.moveBy(o/r.scale-i.x,s/r.scale-i.y),s+=(e.getHeightWidth().height+30)*r.scale)}}).catch(a.onerror),t.remove()},t))):(c+=10)>=y&&(clearInterval(l),l=-1)},10))}}function p(e,t,n){let i=document.createElement("div");i.classList.add("goog-menuitem"),i.setAttribute("role","menuitem"),i.style.userSelect="none",i.innerText=e,i.addEventListener("click",t),n.parentElement.style.height="4500px",n.appendChild(i)}function v(n,i,o){try{var s=Blockly.Xml.workspaceToDom(r);let t;if(null===n)t=Blockly.Xml.domToText(s,r);else{let e=function t(e,n){if(e.getAttribute("id")===n)return e;var i=e.children;for(let e=0;e<i.length;e++){var o=t(i[e],n);if(null!==o)return o}return null}(s,n);for(;null!==e&&"block"!==e.tagName.toLowerCase();)e=e.parentElement;if(null===e)throw new Error("复制失败:找不到积木");if(o){let t=e.children;for(let e=0;e<t.length;e++)"next"===t[e].tagName.toLowerCase()&&(t[e].remove(),e--)}if(i)for(;null!==e.parentElement&&("block"===e.parentElement.tagName.toLowerCase()||"next"===e.parentElement.tagName.toLowerCase());)e=e.parentElement;t="<xml>"+Blockly.Xml.domToText(e,r)+"</xml>"}navigator.clipboard.writeText(t).then(function(){}).catch(a.onerror)}catch(e){a.onerror(e)}}h.func.add({id:"copyblock",name:"复制积木为文字",info:"在右键菜单中添加“复制积木”“粘贴积木”选项，可以跨作品复制，或者粘贴到记事本(是xml格式)",default:!1,option:{},onenable:function t(e,n){a=e,n=void 0===n?0:n;try{r=Blockly.getMainWorkspace(),i=r.getFlyout().getWorkspace(),(o=document.getElementsByClassName("injectionDiv")[0]).addEventListener("touchstart",m,!0),document.body.addEventListener("mousedown",f,!0),a.log("打开 TFGS"),a.log(r,i)}catch(e){return a.onerror(e),a.log("TFGS 启动失败次数: ",n+1),void(s=setTimeout(function(){t(a,n+1)},1e3))}},ondisable:function(){-1!==s&&(clearTimeout(s),s=-1),o&&o.removeEventListener("touchstart",m,!0),document.body.removeEventListener("mousedown",f,!0),a.log("关闭 TFGS")},onoption:function(){}})}let t;h.func.add({id:"example",name:"自定义窗口标题",author:"作者名字",version:"v0.1.0",info:"让你能够修改窗口的标题",default:!1,option:{title:{type:"text",name:"窗口标题",maxlength:16,default:"示例标题"}},onenable:function(e){t=document.title,document.title=e.getoption().title},ondisable:function(e){document.title=t},onoption:function(e){document.title=e.getoption().title}});{let t=null,n=-1,i=null;function s(){if(null===i){let e=(i=h.window.create({title:"forceColor",haveLogo:!1,canClose:!1,canMaximize:!1,canMinimize:!1,x:100,y:80,minHeight:120,minWidth:80,width:80,height:120})).innerDiv,c=(e.innerHTML=`\n<input type="text" value="0"></input><br/>\n<input type="text" value="#00ff00"></input><br/>\n<input type="text" value="#ff0000"></input><br/>\n<input type="text" value="SOLID"></input><br/>\n<input type="button" value="PUSH"></input>\n`,e.children);c[8].addEventListener("click",function(){try{{var o,s=Number(c[0].value),a={primary:c[2].value,secondary:c[4].value,gradientType:c[6].value},r="paint-editor_editor-container-top_";let e=(o=document.querySelector(`[class^=${r}],[class*= ${r}]`).children[1].children[0].children[s])[function(){let e=Object.keys(o),t=null;for(var n in e)"__reactInternalInstance$"===e[n].slice(0,24)&&(t=e[n]);if(null===t)throw new Error("reactInternelInstance not found");return t}()].return.return.return.stateNode,t=(e.handleChangeGradientType(a.gradientType),e.props.onChangeColorIndex(0),e.handleChangeColor(a.primary),"SOLID"!==a.gradientType&&(e.props.onChangeColorIndex(1),e.handleChangeColor(a.secondary)),e.handleCloseColor(),e.props.onUpdateImage(),function(){var e,t=document.querySelector("[class^=gui_page-wrapper_]");let n=Object.keys(t),i=null;for(e in n)"__reactInternalInstance$"===n[e].slice(0,24)&&(i=n[e]);if(null===i)throw new Error("reactInternelInstance not found");return t[i].child.stateNode.store}()),n=t.getState().scratchPaint.color;var l=1===s?"strokeColor":"fillColor";n[l].gradientType=a.gradientType,n[l].primary=a.primary,n[l].secondary=a.secondary;let i=t.getState().scratchGui.vm;i.refreshWorkspace()}}catch(e){t.onerror(e)}})}}h.func.add({id:"forcecolor",name:"qiangxinshezhitoumingyanse",onenable:function(e){t=e,-1===n&&(n=setInterval(s,100))},ondisable:function(){-1!==n&&(clearInterval(n),n=-1),null!==i&&(i.close(),i=null)},onoption:function(){}})}{let f,t=-1,m={},n={},i=!1;function b(e){let t=w(e);if(null===t)return null;for(var n in t=t.classList)if(e===t[n].slice(0,e.length))return t[n];return null}function w(e){return document.querySelector(`[class^=${e}],[class*= ${e}]`)}function a(n){var i=n.buttonid,e=n.enable;let o=n.addinner,s=n.removeinner;var a=n.styles,r=n.targetcss;let l=n.cssname,c=n.onadd,d=n.onremove;if(e){if(void 0!==m[i]&&(e=w(r),m[i].parentElement!==e&&(m[i].remove(),(m[i]=void 0)!==l&&document.body.classList.remove(l),"function"==typeof d&&d(),f.info(i+": restart"))),void 0===m[i]){let t=w(r);if(null!==t){let e=document.createElement("span");for(var u in e.classList.add(b("button_outlined-button_")),e.classList.add(b("stage-header_stage-button_")),e.classList.add("tfgsGuimodifyButton"),a)e.style[u]=a[u];e.innerText=o,e.checked=!1,e.addEventListener("click",function(){e.checked?(void 0!==l&&document.body.classList.remove(l),"function"==typeof d&&d(),e.innerText=o):(void 0!==l&&document.body.classList.add(l),"function"==typeof c&&c(),e.innerText=s),e.checked^=!0,dispatchEvent(new Event("resize"))}),t.appendChild(e),n.clickaftercreate&&e.click(),m[i]=e,f.info(i+": OK")}}}else void 0!==m[i]&&(m[i].remove(),(m[i]=void 0)!==l&&document.body.classList.remove(l),"function"==typeof d&&d(),dispatchEvent(new Event("resize")),f.info(i+": OFF"))}function l(){try{let e=w("sprite-selector_scroll-wrapper_");function t(){let e=m.fullscreen;null===document.fullscreenElement!=("✠"===e.innerText)&&e.click()}null!==e&&(n.foldspriteinfo||n.foldstagebutton||n.foldthestage?e.style.position="relative":e.style.position="inherit"),n.expand100?document.body.classList.contains("tfgsGuimodifyExpand100")||(document.body.classList.add("tfgsGuimodifyExpand100"),dispatchEvent(new Event("resize"))):document.body.classList.contains("tfgsGuimodifyExpand100")&&(document.body.classList.remove("tfgsGuimodifyExpand100"),dispatchEvent(new Event("resize"))),n.foldmenu?""===document.body.style.getPropertyValue("--tfgsGuimodifyMenubarHeight")&&document.body.style.setProperty("--tfgsGuimodifyMenubarHeight",window.getComputedStyle(w("gui_menu-bar-position_")).height):""!==document.body.style.getPropertyValue("--tfgsGuimodifyMenubarHeight")&&document.body.style.removeProperty("--tfgsGuimodifyMenubarHeight"),a({buttonid:"foldmenubar",enable:n.foldmenu,styles:{left:0,top:"100%",position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"gui_menu-bar-position_",cssname:"tfgsGuimodifyMenubarFold",clickaftercreate:!0}),a({buttonid:"fullscreen",enable:n.fullscreen,styles:{right:"calc(2em + 1px)",top:"0.3em",position:"absolute"},addinner:"✠",removeinner:"×",targetcss:"gui_editor-wrapper_",cssname:"tfgsGuimodifyFullscreen",onadd:function(e){document.body.requestFullscreen().catch(f.onerror)},onremove:function(e){document.exitFullscreen().catch(f.onerror)}}),n.fullscreen!==i&&(n.fullscreen?document.addEventListener("fullscreenchange",t):document.removeEventListener("fullscreenchange",t),i=n.fullscreen),a({buttonid:"foldstagetarget",enable:n.foldstagetarget,styles:{right:0,top:"0.3em",position:"absolute"},addinner:"▶",removeinner:"◀",targetcss:"gui_editor-wrapper_",cssname:"tfgsGuimodifyStagetargetFold"}),a({buttonid:"foldblocktool",enable:n.foldblocktool,styles:{left:"calc(60px + 0.5em)",top:"0.5em",position:"absolute",zIndex:2e3},addinner:"◀",removeinner:"▶",targetcss:"injectionDiv",cssname:"tfgsGuimodifyBlocktoolFold"}),a({buttonid:"foldspriteinfo",enable:n.foldspriteinfo,styles:{left:0,top:0,position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsGuimodifySpriteinfoFold"}),a({buttonid:"foldstagebutton",enable:n.foldstagebutton,styles:{right:0,top:"calc(2em + 1px)",position:"absolute"},addinner:"▶",removeinner:"◀",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsGuimodifyStagebuttonFold"}),a({buttonid:"foldthestage",enable:n.foldthestage,styles:{right:0,top:0,position:"absolute"},addinner:"▲",removeinner:"▼",targetcss:"sprite-selector_scroll-wrapper_",cssname:"tfgsGuimodifyStageFold"}),a({buttonid:"foldassetpanel",enable:n.foldassetpanel,styles:{right:0,top:0,position:"absolute"},addinner:"▶",removeinner:"◀",targetcss:"selector_wrapper_",cssname:"tfgsGuimodifyAssetpanelFold"})}catch(e){f.error(e)}}h.func.add({id:"guifold",name:"折叠展开按钮",info:"添加可以折叠舞台、角色，展开列表等区域的按钮",option:{foldmenu:{type:"check",name:"折叠菜单",default:!0},fullscreen:{type:"check",name:"全屏按钮",default:!0},foldblocktool:{type:"check",name:"折叠jimuhe",default:!0},foldstagetarget:{type:"check",name:"折叠舞台和角色列表",default:!0},foldspriteinfo:{type:"check",name:"折叠角色参数",default:!0},foldstagebutton:{type:"check",name:"折叠舞台按钮",default:!0},foldthestage:{type:"check",name:"折叠舞台",default:!0},foldassetpanel:{type:"check",name:"折叠asset",default:!0},expand100:{type:"check",name:"填满屏幕(实验)",default:!1}},onenable:function(e){f=e,n=f.getoption(),-1===t&&(t=setInterval(l,200))},ondisable:function(){-1!==t&&(clearInterval(t),n={},l(),t=-1)},onoption:function(){n=f.getoption()}})}let n;function i(){let e=h.window.create({title:"Teriteri",canMaximize:!1,canMinimize:!1,canResize:!1,height:130,width:130,onClose:c});e.innerDiv.style="vertical-align:middle;text-align:center;font-size:80px;",e.innerDiv.innerText="☆",n.push(e)}function c(){n.splice(n.indexOf(this),1),i(),i()}h.func.add({id:"windowf___",name:"window f___",onenable:function(e){n=[],i()},ondisable:function(){for(var e in n)n[e].onClose=function(){},n[e].close()},onoption:function(){}});{let e=document.createElement("style");e.innerHTML='.tfgsButton{display:inline-block;min-width:40px;height:25px;line-height:25px;text-align:center;font-size:16px;margin:2px;background:#fff;user-select:none;border-radius:2px;box-shadow:0 0 2px rgba(0,0,0,.5)}.tfgsButton:active{background:#9cf}.tfgsDisable{display:none}.tfgsRight{float:right}.tfgsLogFormat{display:block;white-space:pre-wrap;word-break:break-all;font-family:monospace;font-size:15;overflow:scroll}.tfgsLogFormat>:nth-child(odd){background:#f0f8ff}.tfgsLogFormat>:nth-child(2n){background:#def}.tfgsLogContent{height:calc(100% - 30px);background:#fff}.tfgsLogButtons{height:30px;background:var(--tfgsWindowColor)}.tfgsMenuContent{height:calc(100% - 30px);background:#f0f8ff;overflow:auto;text-align:center}.tfgsMenuButtons{height:30px;background:var(--tfgsWindowColor)}.tfgsMenuFunc{margin:5px;border-radius:2px;box-shadow:0 0 2px rgba(0,0,0,.5);overflow:hidden;text-align:left}.tfgsMenuFuncOption{background:#def;padding:2px}.tfgsMenuFuncOptionOne{display:inline-block;margin:2px;padding:2px;background:#bdf;box-shadow:0 0 2px rgba(0,0,0,.5);border-radius:2px;min-width:calc(25% - 10px);max-width:calc(100% - 10px)}.tfgsMenuFunc input,.tfgsMenuFunc select{position:relative;vertical-align:middle;border:none;background:#fff;width:100px;height:20px;margin:2px;padding:2px;box-shadow:0 0 2px rgba(0,0,0,.5);border-radius:2px}.tfgsMenuFuncOptionOne>input{box-shadow:0 0 2px rgba(0,0,0,.5) inset}.tfgsMenuFuncOptionOne>input[type=checkbox],.tfgsMenuFuncTitle>input{width:20px;height:20px;box-shadow:0 0 2px rgba(0,0,0,.5)}.tfgsMenuFunc input:active,.tfgsMenuFunc select:active{background:#9cf}.tfgsMenuFunc input:focus,.tfgsMenuFunc select:focus{background:#def;outline:0}.tfgsMenuFuncTitle{background:#08f;color:#fff;padding:2px;font-weight:700;font-family:monospace}.tfgsMenuFuncInfo{font-size:12px}.tfgsMenuFuncName{font-size:15px}.tfgsWindow.tfgsEmergency{--tfgsWindowColor:#f80}.tfgsWindow{--tfgsWindowColor:#08f;box-shadow:0 0 2px #000;position:fixed;background:#fff;border:3px solid var(--tfgsWindowColor);border-radius:3px;overflow:hidden;box-sizing:border-box}.tfgsWindow *{box-sizing:content-box}.tfgsWindowTitle{background:var(--tfgsWindowColor);display:flex;display:-webkit-flex;flex-flow:row nowrap;align-items:center;border-bottom:3px solid var(--tfgsWindowColor);color:#fff;font-family:sans-serif;font-size:16px;line-height:20px;height:20px}.tfgsWindowTitle>span{width:20px;height:20px;text-align:center;flex:none;user-select:none;-moz-user-select:none}.tfgsWindowTitle>span:active{background:rgba(0,0,0,.25);box-shadow:1px 1px 2px rgba(0,0,0,.3) inset}.tfgsWindowTitle>.tfgsWindowText{width:fit-content;flex:auto;overflow:hidden;white-space:pre;text-overflow:ellipsis;text-overflow:"...";position:relative}.tfgsWindowTitle>.tfgsWindowText:active{background:0 0;box-shadow:none}.tfgsWindowContent{height:calc(100% - 20px - 2px);overflow:auto;position:relative}.tfgsWindowResize{position:absolute;right:0;bottom:0;width:0;height:0;border-left:15px solid transparent;border-bottom:15px solid var(--tfgsWindowColor);cursor:se-resize}.tfgsWindowResize:after{content:"=";position:absolute;left:-8px;top:0;transform:rotate(-45deg);color:#fff}span.tfgsGuimodifyButton{position:absolute;color:grey;font-size:1em;line-height:1em;text-align:center}body.tfgsGuimodifyMenubarFold div[class^=gui_menu-bar-position_]{top:calc(0px - var(--tfgsGuimodifyMenubarHeight));margin-bottom:calc(0px - var(--tfgsGuimodifyMenubarHeight))}body.tfgsGuimodifyMenubarFold div[class^=gui_body-wrapper_]{height:100%}body.tfgsGuimodifyBlocktoolFold .blocklyFlyout,body.tfgsGuimodifyBlocktoolFold .blocklyFlyoutScrollbar{left:-250px}body.tfgsGuimodifyStagetargetFold div[class^=gui_stage-and-target-wrapper_]{display:none}body.tfgsGuimodifySpriteinfoFold div[class^=sprite-info_sprite-info_]{max-height:0;padding:0;overflow:hidden}body.tfgsGuimodifyStagebuttonFold div[class^=target-pane_stage-selector-wrapper_]{max-width:0;padding:0;margin-left:0;margin-right:0;overflow:hidden}body.tfgsGuimodifyStageFold div[class^=stage-wrapper_stage-canvas-wrapper_]{max-height:0;padding:0;overflow:hidden}body.tfgsGuimodifyFullscreen{overflow:scroll}body.tfgsGuimodifyExpand100{position:fixed;bottom:0}body.tfgsGuimodifyAssetpanelFold [class^=selector_wrapper_]{position:absolute;height:100%;width:100%;z-index:2}body.tfgsGuimodifyAssetpanelFold [class^=selector_list-area_]{flex-direction:row;flex-wrap:wrap;align-content:flex-start}body.tfgsGuimodifyAssetpanelFold [class*=" sprite-selector-item_sprite-selector-item_"]{margin-left:.8em}body.tfgsGuimodifyAssetpanelFold [class^=asset-panel_detail-area_]{padding-left:45px}',document.head.appendChild(e)}h.data.load().then(h.button.create).catch(h.error)}catch(e){throw alert(e.message),console.error(e),e}